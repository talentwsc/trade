(function(){var e={2248:function(e,t,s){"use strict";var r=s(4331),o=s(4074);const i={id:"app"};function a(e,t,s,r,a,n){const l=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",i,[(0,o.bF)(l)])}var n={name:"App",created(){}},l=s(9562);const g=(0,l.A)(n,[["render",a]]);var d=g,c=s(7924),p=(s(9819),s(5077)),h=s(4002),u=s(3105);const y=e=>((0,o.Qi)("data-v-5e5f7558"),e=e(),(0,o.jt)(),e),m=y((()=>(0,o.Lk)("div",{class:"bg-panel"},null,-1))),f={class:"home-panel align-center"},b={key:1,class:"left-25px right-25px"},S=y((()=>(0,o.Lk)("div",{class:"tip-panel color-white size-16px"},[(0,o.Lk)("div",{style:{width:"600px","text-align":"left"}},"交易提示：开始交易前，请确保您的交易帐号已完成以下几点设置："),(0,o.Lk)("div",{class:"top-10px"}),(0,o.Lk)("div",{style:{width:"600px","text-align":"left"}},[(0,o.Lk)("div",null,[(0,o.eW)("1. 请在设置中找到“Api密钥”，生成帐户的ApiKey，ApiSecret（区分模拟盘和实盘）"),(0,o.Lk)("span",{class:"color-red"},"（重要）")]),(0,o.Lk)("div",null,[(0,o.eW)("2. 仓位模式已设置为“双向持仓模式”"),(0,o.Lk)("span",{class:"color-red"},"（重要）")]),(0,o.Lk)("div",null,[(0,o.eW)("3. 在交易的品种上设置好“全仓”的杠杆，如50x，100x"),(0,o.Lk)("span",{class:"color-red"},"（重要）")]),(0,o.Lk)("div",null,[(0,o.eW)("4. 注意仓位风险限额，根据资金量控制好对应的杠杆倍数"),(0,o.Lk)("span",{class:"color-red"},"（重要）")]),(0,o.Lk)("div",null,[(0,o.eW)('5. 以上步骤完成之后，选择"模拟交易"或"实盘交易"，开启正式交易'),(0,o.Lk)("span",{class:"color-red"},"（重要）")])])],-1))),T={class:"version-panel"},F={class:"color-white version-label"};function k(e,t,s,r,i,a){const n=(0,o.g2)("el-button"),l=(0,o.g2)("el-col"),g=(0,o.g2)("el-row");return(0,o.uX)(),(0,o.CE)(o.FK,null,[m,(0,o.Lk)("div",f,[(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24,class:"horizontal-vertical-center"},{default:(0,o.k6)((()=>[i.userConfig.showMock&&i.userConfig.mock.apiKey?((0,o.uX)(),(0,o.Wv)(n,{key:0,class:"btn1",type:"danger",onClick:a.doMock},{default:(0,o.k6)((()=>[(0,o.eW)("模拟交易")])),_:1},8,["onClick"])):(0,o.Q3)("",!0),i.userConfig.showMock&&i.userConfig.mock.apiKey&&i.userConfig.real.apiKey?((0,o.uX)(),(0,o.CE)("span",b)):(0,o.Q3)("",!0),(i.userConfig.real.apiKey,(0,o.uX)(),(0,o.Wv)(n,{key:2,class:"btn2",type:"success",onClick:a.doReal},{default:(0,o.k6)((()=>[(0,o.eW)("实盘交易")])),_:1},8,["onClick"]))])),_:1})])),_:1}),(0,o.bF)(g,{class:"top-20px"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24,class:"horizontal-vertical-center"},{default:(0,o.k6)((()=>[S])),_:1})])),_:1})]),(0,o.Lk)("div",T,[(0,o.Lk)("span",F,"币海之路加密货币交易系统"+(0,u.v_)("（"+i.userConfig.version+"）"),1)])],64)}s(5379),s(4363),s(6403),s(1609);var v=s(5431),C=s(3361),w=s(2944),O=JSON.parse('{"systemName":"齐天数字货币交易系统","version":"V2024.07.0601","versionCode":"2024070601","name":"trader","email":"","updateTime":"2024-07-07 13:57:00","showMock":true,"real":{"apiKey":"6578c23d-9c87-4808-aaad-425cbd56bb36","apiSecret":"83E6F92242F47A8E1173572E167EF02A"},"mock":{"apiKey":"6578c23d-9c87-4808-aaad-425cbd56bb36","apiSecret":"83E6F92242F47A8E1173572E167EF02A"}}'),P={name:"home",components:{ElMessage:v.nk,ElMessageBox:C.s,ElNotification:w.df},data(){return{userConfig:{}}},created(){this.init()},methods:{init(){this.userConfig=O,this.$ls.set(""+(this.userConfig.mock.apiKey+"_mock_passphrase"),""),this.$ls.set(""+(this.userConfig.real.apiKey+"_real_passphrase"),""),this.$ls.set(""+(this.userConfig.mock.apiKey+"_mock_openSwitch"),!1),this.$ls.set(""+(this.userConfig.real.apiKey+"_real_openSwitch"),!1)},doMock(){C.s.prompt("请输入帐号（模拟交易）：","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"text"}).then((({value:e})=>{e?this.continueDoMock(e):(0,w.df)({message:"请输入帐号！",type:"warning",position:"top-left",duration:2e3})})).catch((()=>{}))},continueDoMock(e){C.s.prompt("请输入密码（模拟交易）：","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"password"}).then((({value:e})=>{if(e){if("raycoWsc543"!=e)return void(0,w.df)({message:"密码有误！",type:"warning",position:"top-left",duration:2e3});this.$ls.set(""+(this.userConfig.mock.apiKey+"_mock_passphrase"),e),this.$ls.set(""+(this.userConfig.mock.apiKey+"_mock_openSwitch"),!1),this.$router.push({path:"/trade/0"})}else(0,w.df)({message:"请输入密码！",type:"warning",position:"top-left",duration:2e3})})).catch((()=>{}))},doReal(){C.s.prompt("请输入帐号（实盘交易）：","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"text"}).then((({value:e})=>{e?this.continueDoReal(e):(0,w.df)({message:"请输入密码！",type:"warning",position:"top-left",duration:2e3})})).catch((()=>{}))},continueDoReal(e){C.s.prompt("请输入密码（实盘交易）：","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"password"}).then((({value:e})=>{if(e){if("raycoWsc543"!=e)return void(0,w.df)({message:"密码有误！",type:"warning",position:"top-left",duration:2e3});this.$ls.set(""+(this.userConfig.real.apiKey+"_real_passphrase"),e),this.$ls.set(""+(this.userConfig.real.apiKey+"_real_openSwitch"),!1),this.$router.push({path:"/trade/1"})}else(0,w.df)({message:"请输入密码！",type:"warning",position:"top-left",duration:2e3})})).catch((()=>{}))}}};const x=(0,l.A)(P,[["render",k],["__scopeId","data-v-5e5f7558"]]);var A=x;function L(e,t,s,r,o,i){return null}var I={name:"index",props:{wsUrl:{type:String,require:!0},type:{type:String},logSwitch:{type:Boolean,default:!1}},data(){return{socket:"",connected:!1,alreadyBack:!1}},watch:{wsUrl:{immediate:!0,handler(){}}},methods:{init(){this.wsUrl&&""!==this.wsUrl.trim()&&("undefined"===typeof WebSocket?(console.error("您的浏览器不支持socket"),this.$message({message:"您的浏览器不支持socket",type:"warning"})):(this.socket&&this.socket.close(),this.socket=new WebSocket(this.wsUrl),this.socket.onopen=this.open,this.socket.onerror=this.error,this.socket.onmessage=this.getMessage,this.socket.onclose=this.close))},open(){this.connected=!0,this.$emit("open",{type:this.type})},error(){this.connected=!1,this.$emit("error",{type:this.type})},getMessage(e){let t=e.data;"pong"!=t&&("WEBSOCKET_SESSION_CLOSE"!=t?this.$emit("getMessage",{type:this.type,response:JSON.parse(t)}):this.close())},close(){this.socket?(this.socket.close(),this.$emit("close",{type:this.type})):console.error("socket is not exists"),this.socket=null,this.connected=!1,this.alreadyBack||setTimeout((()=>{this.init()}),5e3)},closeAndBack(){this.socket?(this.socket.close(),this.$emit("close",{type:this.type})):console.error("socket is not exists"),this.socket=null,this.connected=!1,this.alreadyBack=!0},send(e){this.sendWithLog(e,!0)},sendWithLog(e,t){try{this.socket?this.connected?(this.logSwitch&&console.log("send : ",e),this.socket.send(e)):console.error("socket is not connected"):console.error("socket is not exists")}catch(s){console.log("send error : ",s)}},pingpong(){let e="ping";this.sendWithLog(e,!1)}},beforeDestroy(){this.close()}};const _=(0,l.A)(I,[["render",L]]);var B=_;const D=e=>((0,o.Qi)("data-v-7d697638"),e=e(),(0,o.jt)(),e),M={class:"TRADE-PANEL"},$={key:0,class:"strategy-switch"},E={class:"log-switch"},R={class:"trade-exit"},K={class:"align-center"},W={class:"login-panel"},U={class:"size-14px color-orange"},G={style:{"margin-top":"-10px"}},V={class:"top-5px align-left"},N=D((()=>(0,o.Lk)("span",{class:"size-12px left-10px"},"Tickers频道：",-1))),q={class:"top-5px align-left"},z=D((()=>(0,o.Lk)("span",{class:"size-12px left-10px"},"帐户频道：",-1))),H=D((()=>(0,o.Lk)("span",{class:"size-12px left-10px"},"持仓频道：",-1))),j=D((()=>(0,o.Lk)("span",{class:"size-12px left-10px"},"订单频道：",-1))),Y={class:"top-5px align-left"},X=D((()=>(0,o.Lk)("span",{class:"size-12px left-10px"},"策略频道：",-1))),J=D((()=>(0,o.Lk)("span",{class:"size-12px left-10px"},"高级策略频道：",-1))),Q={class:"top-10px"},Z={key:1,class:"open-logo"},ee=D((()=>(0,o.Lk)("span",null,"策略已启动",-1))),te=[ee],se={class:"tick-panel align-left"},re=D((()=>(0,o.Lk)("hr",null,null,-1))),oe={class:"top-10px"},ie=D((()=>(0,o.Lk)("span",{class:"color-orange"},"  USDT",-1))),ae=D((()=>(0,o.Lk)("span",{class:"color-orange"},"  秒，每隔N秒重新下委托单",-1))),ne=D((()=>(0,o.Lk)("span",{class:"color-orange"},"  秒，N秒后开启初始止盈",-1))),le=D((()=>(0,o.Lk)("span",{class:"color-darkgray"}," 张",-1))),ge={key:0,class:"color-orange"},de={key:1,class:"color-orange"},ce={key:2,class:"color-orange"},pe={key:3,class:"color-orange"},he=D((()=>(0,o.Lk)("hr",null,null,-1))),ue=D((()=>(0,o.Lk)("span",{class:"color-darkgray"}," USDT",-1))),ye=D((()=>(0,o.Lk)("span",{class:"color-darkgray"}," USDT",-1))),me=D((()=>(0,o.Lk)("span",{class:"color-darkgray"}," %",-1))),fe=D((()=>(0,o.Lk)("span",{class:"color-darkgray"}," % 收益率达到时激活移动止盈止损",-1))),be=D((()=>(0,o.Lk)("span",{class:"color-darkgray"}," % 1位小数，0.1代表0.1%",-1))),Se=D((()=>(0,o.Lk)("span",{class:"color-darkgray"}," USDT",-1))),Te=D((()=>(0,o.Lk)("span",{class:"color-darkgray"}," % 1位小数，0.1代表0.1%",-1))),Fe=D((()=>(0,o.Lk)("span",{class:"color-darkgray"}," USDT",-1))),ke=D((()=>(0,o.Lk)("hr",null,null,-1))),ve={key:4,class:"align-center"},Ce={class:"horizontal-vertical-center top-20px"},we={class:"account-panel align-left"},Oe={class:"color-green"},Pe={class:"color-green"},xe={class:"color-green"},Ae={class:"color-green"},Le={class:"color-green"},Ie={class:"color-green"},_e={class:"color-green"},Be={key:1,class:"noconfig-panel horizontal-vertical-center"},De={key:0,class:"order-panel align-left"},Me=D((()=>(0,o.Lk)("span",null,"/",-1))),$e={class:(0,u.C4)("color-green")},Ee={key:1,class:"order-panel align-left"},Re={class:"color-green"},Ke={class:"color-green"},We={class:(0,u.C4)("")},Ue={class:(0,u.C4)("")},Ge={class:(0,u.C4)("color-green")};function Ve(e,t,s,i,a,n){const l=(0,o.g2)("el-switch"),g=(0,o.g2)("el-button"),d=(0,o.g2)("el-input"),c=(0,o.g2)("el-form-item"),p=(0,o.g2)("el-form"),h=(0,o.g2)("el-col"),y=(0,o.g2)("arrow-down"),m=(0,o.g2)("el-icon"),f=(0,o.g2)("el-dropdown-item"),b=(0,o.g2)("el-dropdown-menu"),S=(0,o.g2)("el-dropdown"),T=(0,o.g2)("el-row"),F=(0,o.g2)("el-option"),k=(0,o.g2)("el-select"),v=(0,o.g2)("el-date-picker"),C=(0,o.g2)("el-upload"),w=(0,o.g2)("el-tag"),O=(0,o.g2)("el-table-column"),P=(0,o.g2)("el-table"),x=B;return(0,o.uX)(),(0,o.CE)("div",M,[a.accountConfig.uid&&a.privacyLogined&&a.businessLogined?((0,o.uX)(),(0,o.CE)("span",$,[(0,o.bF)(l,{modelValue:a.strategyForm.openSwitch,"onUpdate:modelValue":t[0]||(t[0]=e=>a.strategyForm.openSwitch=e),"active-text":"策略已开启","inactive-text":"策略已关闭",onChange:n.handleOpenSwitchChanged},null,8,["modelValue","onChange"])])):(0,o.Q3)("",!0),(0,o.Lk)("span",E,[(0,o.bF)(l,{modelValue:a.openLogSwitch,"onUpdate:modelValue":t[1]||(t[1]=e=>a.openLogSwitch=e),"active-text":"日志已开启","inactive-text":"日志已关闭"},null,8,["modelValue"])]),(0,o.Lk)("span",R,[(0,o.bF)(g,{type:"primary",icon:"HomeFilled",onClick:n.doBack},{default:(0,o.k6)((()=>[(0,o.eW)("退出交易")])),_:1},8,["onClick"])]),(0,o.Lk)("div",K,[(0,o.bF)(T,null,{default:(0,o.k6)((()=>[(0,o.bF)(h,{span:8},{default:(0,o.k6)((()=>[(0,o.bo)((0,o.Lk)("div",W,[(0,o.Lk)("div",null,[(0,o.Lk)("span",U,(0,u.v_)("交易人："+this.name)+"    "+(0,u.v_)("配置文件更新："+this.updateTime),1)]),(0,o.bF)(p,{ref:"formRef",model:a.form,rules:a.rules,"label-width":"80px"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{prop:"apiKey",label:"APIKey",style:{"margin-top":"10px"}},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w340",modelValue:a.form.apiKey,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.apiKey=e),disabled:!!a.strategyForm.openSwitch,readonly:""},null,8,["modelValue","disabled"])])),_:1}),(0,o.bF)(c,{prop:"apiSecret",label:"APISecret"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"password",class:"w340",modelValue:a.form.apiSecret,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.apiSecret=e),disabled:!!a.strategyForm.openSwitch,readonly:""},null,8,["modelValue","disabled"])])),_:1}),(0,o.bF)(c,{prop:"passphrase",label:"passphrase"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"password",class:"w340",modelValue:a.form.passphrase,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.passphrase=e),disabled:!!a.strategyForm.openSwitch,readonly:""},null,8,["modelValue","disabled"])])),_:1})])),_:1},8,["model","rules"]),a.accountConfig.uid?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",G,[(0,o.bF)(g,{type:a.privacyLogined?"success":"primary",icon:"UserFilled",size:"small",class:"left-10px",onClick:n.doPrivacyLogin,disabled:!a.wsPrivacyConnected||!!a.strategyForm.openSwitch},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)(a.privacyLogined?"私有频道已登录":"私有频道未登录"),1)])),_:1},8,["type","onClick","disabled"]),(0,o.bF)(g,{type:a.businessLogined?"success":"primary",icon:"UserFilled",size:"small",class:"left-10px",onClick:n.doBusinessLogin,disabled:!a.wsBusinessConnected||!!a.strategyForm.openSwitch},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)(a.businessLogined?"业务频道已登录":"业务频道未登录"),1)])),_:1},8,["type","onClick","disabled"])]),(0,o.Lk)("div",V,[(0,o.Lk)("span",{class:(0,u.C4)("size-12px "+(a.wsPublicConnected?"color-green":"color-red"))},(0,u.v_)(a.wsPublicConnected?"公共频道已连接":"公共频道未连接"),3),N,(0,o.Lk)("span",{class:(0,u.C4)("size-12px "+(a.subscribedTickers?"color-green":"color-red"))},(0,u.v_)(a.subscribedTickers?"已订阅":"未订阅"),3)]),(0,o.Lk)("div",q,[(0,o.Lk)("span",{class:(0,u.C4)("size-12px "+(a.wsPrivacyConnected?"color-green":"color-red"))},(0,u.v_)(a.wsPrivacyConnected?"私有频道已连接":"私有频道未连接"),3),z,(0,o.Lk)("span",{class:(0,u.C4)("size-12px "+(a.subscribedAccount?"color-green":"color-red"))},(0,u.v_)(a.subscribedAccount?"已订阅":"未订阅"),3),H,(0,o.Lk)("span",{class:(0,u.C4)("size-12px "+(a.subscribedPositions?"color-green":"color-red"))},(0,u.v_)(a.subscribedPositions?"已订阅":"未订阅"),3),j,(0,o.Lk)("span",{class:(0,u.C4)("size-12px "+(a.subscribedOrders?"color-green":"color-red"))},(0,u.v_)(a.subscribedOrders?"已订阅":"未订阅"),3)]),(0,o.Lk)("div",Y,[(0,o.Lk)("span",{class:(0,u.C4)("size-12px "+(a.wsBusinessConnected?"color-green":"color-red"))},(0,u.v_)(a.wsBusinessConnected?"业务频道已连接":"业务频道未连接"),3),X,(0,o.Lk)("span",{class:(0,u.C4)("size-12px "+(a.subscribedOrdersAlgo?"color-green":"color-red"))},(0,u.v_)(a.subscribedOrdersAlgo?"已订阅":"未订阅"),3),J,(0,o.Lk)("span",{class:(0,u.C4)("size-12px "+(a.subscribedAlgoAdvance?"color-green":"color-red"))},(0,u.v_)(a.subscribedAlgoAdvance?"已订阅":"未订阅"),3)]),(0,o.Lk)("div",Q,[(0,o.bF)(g,{type:"danger",icon:"CircleCloseFilled",size:"small",class:"left-10px",onClick:n.doCancelSubscribe},{default:(0,o.k6)((()=>[(0,o.eW)("取消订阅")])),_:1},8,["onClick"]),(0,o.bF)(g,{type:"warning",icon:"SuccessFilled",size:"small",class:"left-10px",onClick:n.doReSubscribe},{default:(0,o.k6)((()=>[(0,o.eW)("重新订阅")])),_:1},8,["onClick"])])],64)):(0,o.Q3)("",!0),a.strategyForm.openSwitch?((0,o.uX)(),(0,o.CE)("div",Z,te)):(0,o.Q3)("",!0)],512),[[r.aG,a.accountConfig.uid]])])),_:1}),a.privacyLogined&&a.businessLogined?((0,o.uX)(),(0,o.Wv)(h,{key:0,span:9},{default:(0,o.k6)((()=>[(0,o.Lk)("div",se,[(0,o.bF)(T,null,{default:(0,o.k6)((()=>[(0,o.bF)(h,{span:12,class:"horizontal-center"},{default:(0,o.k6)((()=>[(0,o.Lk)("span",null,(0,u.v_)(a.strategyForm.currentInstId+"："),1),(0,o.Lk)("span",null,(0,u.v_)(""!=a.last?a.last:"--"),1)])),_:1}),(0,o.bF)(h,{span:12,class:"vertical-center-horizontal-right"},{default:(0,o.k6)((()=>[(0,o.bF)(S,{trigger:"click",onCommand:n.handleCommand},{dropdown:(0,o.k6)((()=>[(0,o.bF)(b,null,{default:(0,o.k6)((()=>[(0,o.bF)(f,{command:"a",divided:""},{default:(0,o.k6)((()=>[(0,o.eW)("重置参数")])),_:1}),(0,o.bF)(f,{command:"b",divided:""},{default:(0,o.k6)((()=>[(0,o.eW)("保存参数")])),_:1}),(0,o.bF)(f,{command:"c",divided:""},{default:(0,o.k6)((()=>[(0,o.eW)("加载参数")])),_:1}),(0,o.bF)(f,{command:"d",divided:""},{default:(0,o.k6)((()=>[(0,o.eW)("另存为文件")])),_:1})])),_:1})])),default:(0,o.k6)((()=>[(0,o.bF)(g,{type:"primary",size:"small",disabled:!!a.strategyForm.openSwitch},{default:(0,o.k6)((()=>[(0,o.eW)(" 选择操作"),(0,o.bF)(m,{class:"el-icon--right"},{default:(0,o.k6)((()=>[(0,o.bF)(y)])),_:1})])),_:1},8,["disabled"])])),_:1},8,["onCommand"])])),_:1})])),_:1}),re,(0,o.Lk)("div",oe,[(0,o.bF)(p,{ref:"strategyFormRef",model:a.strategyForm,rules:a.strategyRules,"label-width":"120px"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{prop:"currentInstId",label:"交易产品："},{default:(0,o.k6)((()=>[(0,o.bF)(k,{class:"w200",modelValue:a.strategyForm.currentInstId,"onUpdate:modelValue":t[5]||(t[5]=e=>a.strategyForm.currentInstId=e),disabled:!!a.strategyForm.openSwitch,onChange:n.handleInstIdChanged},{default:(0,o.k6)((()=>[(0,o.bF)(F,{label:"BTCUSDT（永续合约）",value:"BTC-USDT-SWAP"}),(0,o.bF)(F,{label:"ETHUSDT（永续合约）",value:"ETH-USDT-SWAP"})])),_:1},8,["modelValue","disabled","onChange"]),(0,o.eW)("   "),(0,o.bF)(k,{class:"w100",modelValue:a.strategyForm.mgnMode,"onUpdate:modelValue":t[6]||(t[6]=e=>a.strategyForm.mgnMode=e),disabled:!!a.strategyForm.openSwitch,onChange:n.handleMgnModeChanged},{default:(0,o.k6)((()=>[(0,o.bF)(F,{label:"逐仓",value:"isolated"}),(0,o.bF)(F,{label:"全仓",value:"cross"})])),_:1},8,["modelValue","disabled","onChange"])])),_:1}),(0,o.bF)(c,{prop:"openSwitch",label:"做单开关",required:""},{default:(0,o.k6)((()=>[(0,o.bF)(l,{modelValue:a.strategyForm.openOrderSwitch,"onUpdate:modelValue":t[7]||(t[7]=e=>a.strategyForm.openOrderSwitch=e),disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),(0,o.Lk)("span",{class:(0,u.C4)((a.strategyForm.openOrderSwitch?"color-green":"color-red")+" left-10px")},(0,u.v_)(a.strategyForm.openOrderSwitch?"开":"关"),3),(0,o.Lk)("span",{class:(0,u.C4)(a.strategyForm.openSwitch?"color-green":"color-red")},"     当前时间："+(0,u.v_)(a.strategyForm.currentTime?a.strategyForm.currentTime:"--"),3)])),_:1}),(0,o.bF)(c,{prop:"openType",label:"开单方式",required:""},{default:(0,o.k6)((()=>[(0,o.bF)(k,{class:"w170",modelValue:a.strategyForm.openType,"onUpdate:modelValue":t[8]||(t[8]=e=>a.strategyForm.openType=e),disabled:!!a.strategyForm.openSwitch,onChange:n.handleOpenTypeChanged},{default:(0,o.k6)((()=>[(0,o.bF)(F,{label:"固定时间点开单",value:e.$constant.OpenType.ByTime},null,8,["value"]),(0,o.bF)(F,{label:"手工开单",value:e.$constant.OpenType.ByManual},null,8,["value"]),(0,o.bF)(F,{label:"突破挂单",value:e.$constant.OpenType.ByLimitBreakThrough},null,8,["value"]),(0,o.bF)(F,{label:"插针回调",value:e.$constant.OpenType.ByBreakThroughThenRollback},null,8,["value"])])),_:1},8,["modelValue","disabled","onChange"])])),_:1}),a.strategyForm.openType==e.$constant.OpenType.ByTime||a.strategyForm.openType==e.$constant.OpenType.ByManual?((0,o.uX)(),(0,o.Wv)(c,{key:0,prop:"openDirection",label:"开单方向",required:""},{default:(0,o.k6)((()=>[(0,o.bF)(k,{class:"w170",modelValue:a.strategyForm.openDirection,"onUpdate:modelValue":t[9]||(t[9]=e=>a.strategyForm.openDirection=e),disabled:!!a.strategyForm.openSwitch},{default:(0,o.k6)((()=>[(0,o.bF)(F,{label:"多空双开",value:e.$constant.OpenDirection.BuyAndSell},null,8,["value"]),(0,o.bF)(F,{label:"只开多",value:e.$constant.OpenDirection.OnlyBuy},null,8,["value"]),(0,o.bF)(F,{label:"只开空",value:e.$constant.OpenDirection.OnlySell},null,8,["value"])])),_:1},8,["modelValue","disabled"])])),_:1})):(0,o.Q3)("",!0),a.strategyForm.openType==e.$constant.OpenType.ByLimitBreakThrough||a.strategyForm.openType==e.$constant.OpenType.ByBreakThroughThenRollback?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.bF)(c,{prop:"breakThroughDistance",label:"突破价"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w90",modelValue:a.strategyForm.breakThroughDistance,"onUpdate:modelValue":t[10]||(t[10]=e=>a.strategyForm.breakThroughDistance=e),placeholder:"需>0",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),ie])),_:1}),a.strategyForm.openType==e.$constant.OpenType.ByBreakThroughThenRollback?((0,o.uX)(),(0,o.Wv)(c,{key:0,prop:"rollBackTimeInterval",label:"插针检测周期"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w90",modelValue:a.strategyForm.rollBackTimeInterval,"onUpdate:modelValue":t[11]||(t[11]=e=>a.strategyForm.rollBackTimeInterval=e),placeholder:"需>0",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),ae])),_:1})):(0,o.Q3)("",!0),a.strategyForm.openType==e.$constant.OpenType.ByBreakThroughThenRollback?((0,o.uX)(),(0,o.Wv)(c,{key:1,prop:"tpTriggerTimeInterval",label:"插针止盈期限"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w90",modelValue:a.strategyForm.tpTriggerTimeInterval,"onUpdate:modelValue":t[12]||(t[12]=e=>a.strategyForm.tpTriggerTimeInterval=e),placeholder:"需>0",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),ne])),_:1})):(0,o.Q3)("",!0),a.strategyForm.openType==e.$constant.OpenType.ByBreakThroughThenRollback?((0,o.uX)(),(0,o.Wv)(c,{key:2,prop:"rollBackDirection",label:"突破方向"},{default:(0,o.k6)((()=>[(0,o.bF)(k,{class:"w170",modelValue:a.strategyForm.rollBackDirection,"onUpdate:modelValue":t[13]||(t[13]=e=>a.strategyForm.rollBackDirection=e),disabled:!!a.strategyForm.openSwitch},{default:(0,o.k6)((()=>[(0,o.bF)(F,{label:"逆势",value:e.$constant.RollBackDirection.Reverse},null,8,["value"]),(0,o.bF)(F,{label:"顺势",value:e.$constant.RollBackDirection.Homeopathy},null,8,["value"])])),_:1},8,["modelValue","disabled"])])),_:1})):(0,o.Q3)("",!0)],64)):(0,o.Q3)("",!0),a.strategyForm.openType==e.$constant.OpenType.ByTime||a.strategyForm.openType==e.$constant.OpenType.ByLimitBreakThrough?((0,o.uX)(),(0,o.Wv)(c,{key:2,prop:"exactTime",label:"开单时间"},{default:(0,o.k6)((()=>[(0,o.bF)(v,{type:"datetime",class:"w340",modelValue:a.strategyForm.exactTime,"onUpdate:modelValue":t[14]||(t[14]=e=>a.strategyForm.exactTime=e),placeholder:"请指定开单时间",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"])])),_:1})):(0,o.Q3)("",!0),(0,o.bF)(c,{prop:"amount",label:"开仓数量"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w90",modelValue:a.strategyForm.amount,"onUpdate:modelValue":t[15]||(t[15]=e=>a.strategyForm.amount=e),placeholder:"需>0",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),le,""!=a.last?((0,o.uX)(),(0,o.CE)("span",ge,"  "+(0,u.v_)(`1张≈${(a.last/1e3*1).toFixed(2)}USDT`),1)):(0,o.Q3)("",!0),0==a.strategyForm.openDirection&&a.leverConfig.maxBuy&&a.leverConfig.maxSell?((0,o.uX)(),(0,o.CE)("span",de,(0,u.v_)(`，最多可开${parseInt(Math.min(parseInt(a.leverConfig.maxBuy),parseInt(a.leverConfig.maxSell))/2)}张`),1)):(0,o.Q3)("",!0),1==a.strategyForm.openDirection&&a.leverConfig.maxBuy&&a.leverConfig.maxSell?((0,o.uX)(),(0,o.CE)("span",ce,(0,u.v_)(`，最多可开${parseInt(a.leverConfig.maxBuy)}张`),1)):(0,o.Q3)("",!0),2==a.strategyForm.openDirection&&a.leverConfig.maxBuy&&a.leverConfig.maxSell?((0,o.uX)(),(0,o.CE)("span",pe,(0,u.v_)(`，最多可开${parseInt(a.leverConfig.maxSell)}张`),1)):(0,o.Q3)("",!0)])),_:1}),he,(0,o.bF)(c,{prop:"openMoveStopLossSwitch",label:"开启止盈止损",required:""},{default:(0,o.k6)((()=>[(0,o.bF)(l,{modelValue:a.strategyForm.openMoveStopLossSwitch,"onUpdate:modelValue":t[16]||(t[16]=e=>a.strategyForm.openMoveStopLossSwitch=e),disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),(0,o.Lk)("span",{class:(0,u.C4)((a.strategyForm.openMoveStopLossSwitch?"color-green":"color-red")+" left-10px")},(0,u.v_)(a.strategyForm.openMoveStopLossSwitch?"止盈止损已开启":"止盈止损未开启"),3)])),_:1}),a.strategyForm.openMoveStopLossSwitch?((0,o.uX)(),(0,o.CE)(o.FK,{key:3},[(0,o.bF)(c,{prop:"slTriggerPosition",label:"初始止损触发"},{default:(0,o.k6)((()=>[(0,o.bF)(k,{class:"w170",modelValue:a.strategyForm.slTriggerPosition,"onUpdate:modelValue":t[17]||(t[17]=e=>a.strategyForm.slTriggerPosition=e),disabled:!!a.strategyForm.openSwitch},{default:(0,o.k6)((()=>[(0,o.bF)(F,{label:"开仓价价距",value:e.$constant.TriggerPosition.FromOpenPosition},null,8,["value"]),(0,o.bF)(F,{label:"强平价价距",value:e.$constant.TriggerPosition.FromForceClosePosition},null,8,["value"])])),_:1},8,["modelValue","disabled"])])),_:1}),(0,o.bF)(c,{prop:"slTriggerPxDistance",label:"初始止损价距"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w170",modelValue:a.strategyForm.slTriggerPxDistance,"onUpdate:modelValue":t[18]||(t[18]=e=>a.strategyForm.slTriggerPxDistance=e),placeholder:"需>0，0为不启用",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),ue])),_:1}),(0,o.bF)(c,{prop:"tpTriggerType",label:"止盈类型",onChange:n.handleTpTriggerTypeChanged},{default:(0,o.k6)((()=>[(0,o.bF)(k,{class:"w170",modelValue:a.strategyForm.tpTriggerType,"onUpdate:modelValue":t[19]||(t[19]=e=>a.strategyForm.tpTriggerType=e),disabled:!!a.strategyForm.openSwitch},{default:(0,o.k6)((()=>[(0,o.bF)(F,{label:"比例(%)",value:e.$constant.TriggerType.ByPercentage},null,8,["value"]),(0,o.bF)(F,{label:"价距(USDT)",value:e.$constant.TriggerType.ByDistance},null,8,["value"])])),_:1},8,["modelValue","disabled"])])),_:1},8,["onChange"]),a.strategyForm.tpTriggerType==e.$constant.TriggerType.ByDistance?((0,o.uX)(),(0,o.Wv)(c,{key:0,prop:"tpTriggerPxDistance",label:"初始止盈价距"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w170",modelValue:a.strategyForm.tpTriggerPxDistance,"onUpdate:modelValue":t[20]||(t[20]=e=>a.strategyForm.tpTriggerPxDistance=e),placeholder:"需>0，0为不启用",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),ye])),_:1})):(0,o.Q3)("",!0),a.strategyForm.tpTriggerType==e.$constant.TriggerType.ByPercentage?((0,o.uX)(),(0,o.Wv)(c,{key:1,prop:"tpTriggerPxPercentage",label:"初始止盈比例"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w170",modelValue:a.strategyForm.tpTriggerPxPercentage,"onUpdate:modelValue":t[21]||(t[21]=e=>a.strategyForm.tpTriggerPxPercentage=e),placeholder:"1位小数，0为不启用",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),me])),_:1})):(0,o.Q3)("",!0),(0,o.bF)(c,{prop:"callback",label:"回调类型",required:""},{default:(0,o.k6)((()=>[(0,o.bF)(k,{class:"w170",modelValue:a.strategyForm.callback,"onUpdate:modelValue":t[22]||(t[22]=e=>a.strategyForm.callback=e),disabled:!!a.strategyForm.openSwitch},{default:(0,o.k6)((()=>[(0,o.bF)(F,{label:"比例(%)",value:e.$constant.Callback.ByPercentage},null,8,["value"]),(0,o.bF)(F,{label:"价距(USDT)",value:e.$constant.Callback.ByDistance},null,8,["value"])])),_:1},8,["modelValue","disabled"])])),_:1}),(0,o.bF)(c,{prop:"moveActiveUplRatio",label:"移动激活比例"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w170",modelValue:a.strategyForm.moveActiveUplRatio,"onUpdate:modelValue":t[23]||(t[23]=e=>a.strategyForm.moveActiveUplRatio=e),placeholder:"2位小数，0为不启用",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),fe])),_:1}),a.strategyForm.callback==e.$constant.Callback.ByPercentage?((0,o.uX)(),(0,o.Wv)(c,{key:2,prop:"longCallbackRatio",label:"多单回调比例"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w170",modelValue:a.strategyForm.longCallbackRatio,"onUpdate:modelValue":t[24]||(t[24]=e=>a.strategyForm.longCallbackRatio=e),placeholder:"1位小数，0为不启用",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),be])),_:1})):((0,o.uX)(),(0,o.Wv)(c,{key:3,prop:"longCallbackSpread",label:"多单回调价距"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w170",modelValue:a.strategyForm.longCallbackSpread,"onUpdate:modelValue":t[25]||(t[25]=e=>a.strategyForm.longCallbackSpread=e),placeholder:"需>0，0为不启用",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),Se])),_:1})),a.strategyForm.callback==e.$constant.Callback.ByPercentage?((0,o.uX)(),(0,o.Wv)(c,{key:4,prop:"shortCallbackRatio",label:"空单回调比例"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w170",modelValue:a.strategyForm.shortCallbackRatio,"onUpdate:modelValue":t[26]||(t[26]=e=>a.strategyForm.shortCallbackRatio=e),placeholder:"1位小数，0为不启用",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),Te])),_:1})):((0,o.uX)(),(0,o.Wv)(c,{key:5,prop:"shortCallbackSpread",label:"空单回调价距"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{type:"text",class:"w170",modelValue:a.strategyForm.shortCallbackSpread,"onUpdate:modelValue":t[27]||(t[27]=e=>a.strategyForm.shortCallbackSpread=e),placeholder:"需>0，0为不启用",disabled:!!a.strategyForm.openSwitch},null,8,["modelValue","disabled"]),Fe])),_:1}))],64)):(0,o.Q3)("",!0),ke,a.strategyForm.openType==e.$constant.OpenType.ByManual||a.strategyForm.openType==e.$constant.OpenType.ByLimitBreakThrough||a.strategyForm.openType==e.$constant.OpenType.ByBreakThroughThenRollback?((0,o.uX)(),(0,o.CE)("div",ve,[(0,o.bF)(g,{type:"primary",icon:"Promotion",onClick:n.confirmOpenOrder,disabled:!a.strategyForm.openSwitch||(!a.strategyForm.openOrderSwitch||(!a.leverConfig.maxBuy||!a.leverConfig.maxSell))},{default:(0,o.k6)((()=>[(0,o.eW)("手工开单")])),_:1},8,["onClick","disabled"])])):(0,o.Q3)("",!0),(0,o.bo)((0,o.Lk)("div",Ce,[(0,o.eW)("   "),(0,o.bF)(C,{"auto-upload":!0,"show-file-list":!1,limit:1,"before-upload":n.loadConfigData},{trigger:(0,o.k6)((()=>[(0,o.bF)(g,{ref:"uploadRef",type:"warning",icon:"Setting",disabled:!!a.strategyForm.openSwitch},{default:(0,o.k6)((()=>[(0,o.eW)("加载参数")])),_:1},8,["disabled"])])),_:1},8,["before-upload"])],512),[[r.aG,!1]])])),_:1},8,["model","rules"])])])])),_:1})):(0,o.Q3)("",!0),a.privacyLogined&&a.businessLogined?((0,o.uX)(),(0,o.Wv)(h,{key:1,span:7},{default:(0,o.k6)((()=>[(0,o.Lk)("div",we,[a.accountConfig.uid?((0,o.uX)(),(0,o.Wv)(p,{key:0,"label-width":"120px"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{label:"可用余额："},{default:(0,o.k6)((()=>[(0,o.Lk)("span",Oe,(0,u.v_)(a.availBal?(1*a.availBal).toFixed(4)+" USDT":"--"),1)])),_:1}),(0,o.bF)(c,{label:"帐户层级："},{default:(0,o.k6)((()=>[(0,o.bo)((0,o.Lk)("span",Pe,"简单交易模式",512),[[r.aG,"1"==a.accountConfig.acctLv]]),(0,o.bo)((0,o.Lk)("span",xe,"单币种保证金模式",512),[[r.aG,"2"==a.accountConfig.acctLv]]),(0,o.bo)((0,o.Lk)("span",Ae,"跨币种保证金模式",512),[[r.aG,"3"==a.accountConfig.acctLv]]),(0,o.bo)((0,o.Lk)("span",Le,"组合保证金模式",512),[[r.aG,"4"==a.accountConfig.acctLv]])])),_:1}),(0,o.bF)(c,{label:"持仓方式："},{default:(0,o.k6)((()=>[(0,o.bo)((0,o.Lk)("span",Ie,"开平仓模式",512),[[r.aG,"long_short_mode"==a.accountConfig.posMode]]),(0,o.bo)((0,o.Lk)("span",_e,"买卖模式",512),[[r.aG,"net_mode"==a.accountConfig.posMode]])])),_:1}),(0,o.bF)(c,{label:"杠杆倍数："},{default:(0,o.k6)((()=>[(0,o.bF)(w,{type:"info",effect:"light"},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)("cross"==a.strategyForm.mgnMode?"全仓":"逐仓"),1)])),_:1}),(0,o.bF)(w,{type:"danger",class:"left-10px",effect:"light"},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)(null!=a.leverConfig.longLever?"多"+a.leverConfig.longLever+"x":"--"),1)])),_:1}),(0,o.bF)(w,{type:"success",class:"left-10px",effect:"light"},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)(null!=a.leverConfig.shortLever?"空"+a.leverConfig.shortLever+"x":"--"),1)])),_:1})])),_:1}),(0,o.bF)(c,{label:"最大可买卖："},{default:(0,o.k6)((()=>[(0,o.bF)(w,{type:"danger",effect:"light"},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)(null!=a.leverConfig.maxBuy?"可开多"+a.leverConfig.maxBuy+"张":"--"),1)])),_:1}),(0,o.bF)(w,{type:"success",class:"left-10px",effect:"light"},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)(null!=a.leverConfig.maxSell?"可开空"+a.leverConfig.maxSell+"张":"--"),1)])),_:1})])),_:1}),(0,o.bF)(c,{label:"IP过滤配置："},{default:(0,o.k6)((()=>[(0,o.Lk)("span",{class:(0,u.C4)(a.accountConfig.ip?"color-green":"")},(0,u.v_)(a.accountConfig.ip?a.accountConfig.ip:"--"),3)])),_:1})])),_:1})):((0,o.uX)(),(0,o.CE)("div",Be,[(0,o.bF)(g,{type:"primary",onClick:n.getAccountConfig},{default:(0,o.k6)((()=>[(0,o.eW)("未获取到帐户配置，点此获取")])),_:1},8,["onClick"])]))])])),_:1})):(0,o.Q3)("",!0)])),_:1}),(0,o.bF)(T,{style:{"margin-top":"-10px"}},{default:(0,o.k6)((()=>[(0,o.bF)(h,{span:24},{default:(0,o.k6)((()=>[a.privacyLogined&&a.businessLogined?((0,o.uX)(),(0,o.CE)("div",De,[(0,o.bF)(T,null,{default:(0,o.k6)((()=>[(0,o.bF)(h,{span:12},{default:(0,o.k6)((()=>[(0,o.bF)(g,{type:"success",icon:"Refresh",class:"left-10px",onClick:n.doRefreshPositions},{default:(0,o.k6)((()=>[(0,o.eW)("刷新")])),_:1},8,["onClick"])])),_:1}),(0,o.bF)(h,{span:12,class:"vertical-center-horizontal-right"},{default:(0,o.k6)((()=>[(0,o.bF)(g,{type:"danger",icon:"Switch",class:"right-15px",onClick:n.doCloseAllOrders,disabled:!(a.orderMap.size>0)},{default:(0,o.k6)((()=>[(0,o.eW)("全部平仓")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1}),(0,o.bF)(P,{data:n.orderList},{default:(0,o.k6)((()=>[(0,o.bF)(O,{prop:"instId",label:"交易产品","min-width":"120",align:"center"}),(0,o.bF)(O,{prop:"posSide",label:"持仓方向","min-width":"120",align:"center"},{default:(0,o.k6)((e=>[(0,o.bo)((0,o.bF)(w,{type:"danger"},{default:(0,o.k6)((()=>[(0,o.eW)("多")])),_:2},1536),[[r.aG,"long"==e.row.posSide]]),(0,o.bo)((0,o.bF)(w,{type:"success"},{default:(0,o.k6)((()=>[(0,o.eW)("空")])),_:2},1536),[[r.aG,"short"==e.row.posSide]]),(0,o.eW)("  "),(0,o.bF)(w,{type:"info"},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)("isolated"==e.row.mgnMode?"逐仓":"全仓"),1)])),_:2},1024),(0,o.eW)("  "),(0,o.bF)(w,{type:"warning"},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)(e.row.lever+"x"),1)])),_:2},1024)])),_:1}),(0,o.bF)(O,{prop:"uplLastPx",label:"收益/收益率","min-width":"120",align:"center"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",{class:(0,u.C4)(e.row.uplLastPx>0?"color-green":"color-red")},(0,u.v_)((1*e.row.uplLastPx).toFixed(2)),3),Me,(0,o.Lk)("span",{class:(0,u.C4)(e.row.uplLastPx>0?"color-green":"color-red")},(0,u.v_)(""!=e.row.uplRatio?(100*e.row.uplRatio).toFixed(2)+"%":"--"),3)])),_:1}),(0,o.bF)(O,{prop:"availPos",label:"持仓数量(张)","min-width":"80",align:"center"},{default:(0,o.k6)((e=>[(0,o.Lk)("span",$e,(0,u.v_)(""!=e.row.availPos?(1*e.row.availPos).toFixed(1)+"张":"--"),1)])),_:1}),(0,o.bF)(O,{prop:"avgPx",label:"开仓均价","min-width":"80",align:"center"},{default:(0,o.k6)((e=>[(0,o.eW)((0,u.v_)(""!=e.row.avgPx?(1*e.row.avgPx).toFixed(1):"--"),1)])),_:1}),(0,o.bF)(O,{prop:"liqPx",label:"预估强平价","min-width":"80",align:"center"},{default:(0,o.k6)((e=>[(0,o.eW)((0,u.v_)(""!=e.row.liqPx?(1*e.row.liqPx).toFixed(1):"--"),1)])),_:1}),(0,o.bF)(O,{prop:"mgnRatio",label:"保证金率","min-width":"80",align:"center"},{default:(0,o.k6)((e=>[(0,o.eW)((0,u.v_)(""!=e.row.mgnRatio?(100*e.row.mgnRatio).toFixed(2)+"%":"--"),1)])),_:1}),(0,o.bF)(O,{prop:"cTime",label:"创建时间","min-width":"100",align:"center"}),(0,o.bF)(O,{prop:"refreshTime",label:"刷新时间","min-width":"100",align:"center"}),(0,o.bF)(O,{prop:"",label:"操作",align:"center","min-width":"100"},{default:(0,o.k6)((e=>[(0,o.bF)(g,{type:"danger",icon:"Switch",onClick:t=>n.doCloseOrder(e.row)},{default:(0,o.k6)((()=>[(0,o.eW)("市价平仓")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])):(0,o.Q3)("",!0),a.businessLogined?((0,o.uX)(),(0,o.CE)("div",Ee,[(0,o.bF)(T,null,{default:(0,o.k6)((()=>[(0,o.bF)(h,{span:12},{default:(0,o.k6)((()=>[(0,o.bF)(g,{type:"success",icon:"Refresh",class:"left-10px",onClick:n.doRefreshAlgoAdvance},{default:(0,o.k6)((()=>[(0,o.eW)("刷新")])),_:1},8,["onClick"])])),_:1}),(0,o.bF)(h,{span:12,class:"vertical-center-horizontal-right"},{default:(0,o.k6)((()=>[(0,o.bF)(g,{type:"danger",icon:"CircleClose",class:"right-15px",onClick:n.doCancelAllAlgos,disabled:!(a.delegateMap.size>0)},{default:(0,o.k6)((()=>[(0,o.eW)("全部撤销")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1}),(0,o.bF)(P,{data:n.delegateList},{default:(0,o.k6)((()=>[(0,o.bF)(O,{prop:"instId",label:"交易产品","min-width":"120",align:"center"}),(0,o.bF)(O,{prop:"ordType",label:"策略类型","min-width":"200",align:"center"},{default:(0,o.k6)((e=>[(0,o.bo)((0,o.bF)(w,{type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)("移动止盈止损")])),_:2},1536),[[r.aG,"move_order_stop"==e.row.ordType]]),(0,o.bo)((0,o.bF)(w,{type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)("单向止盈止损")])),_:2},1536),[[r.aG,"conditional"==e.row.ordType]]),(0,o.bo)((0,o.bF)(w,{type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)("双向止盈止损")])),_:2},1536),[[r.aG,"oco"==e.row.ordType]]),(0,o.bo)((0,o.bF)(w,{type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)("计划委托")])),_:2},1536),[[r.aG,"trigger"==e.row.ordType]]),(0,o.eW)("  "),(0,o.bo)((0,o.bF)(w,{type:"info"},{default:(0,o.k6)((()=>[(0,o.eW)("买卖模式")])),_:2},1536),[[r.aG,"net"==e.row.posSide]]),(0,o.bo)((0,o.bF)(w,{type:"danger"},{default:(0,o.k6)((()=>[(0,o.eW)("平多")])),_:2},1536),[[r.aG,"sell"==e.row.side&&"long"==e.row.posSide]]),(0,o.bo)((0,o.bF)(w,{type:"success"},{default:(0,o.k6)((()=>[(0,o.eW)("平空")])),_:2},1536),[[r.aG,"buy"==e.row.side&&"short"==e.row.posSide]]),(0,o.bo)((0,o.bF)(w,{type:"danger"},{default:(0,o.k6)((()=>[(0,o.eW)("买入开多")])),_:2},1536),[[r.aG,"buy"==e.row.side&&"long"==e.row.posSide]]),(0,o.bo)((0,o.bF)(w,{type:"success"},{default:(0,o.k6)((()=>[(0,o.eW)("卖出开空")])),_:2},1536),[[r.aG,"sell"==e.row.side&&"short"==e.row.posSide]]),(0,o.eW)("  "),(0,o.bF)(w,{type:"info"},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)("isolated"==e.row.tdMode?"逐仓":"全仓"),1)])),_:2},1024),(0,o.eW)("  "),(0,o.bF)(w,{type:"warning"},{default:(0,o.k6)((()=>[(0,o.eW)((0,u.v_)(e.row.lever+"x"),1)])),_:2},1024)])),_:1}),(0,o.bF)(O,{prop:"sz",label:"委托数量(张)","min-width":"100",align:"center"},{default:(0,o.k6)((e=>[(0,o.bo)((0,o.Lk)("span",Re,"全部仓位",512),[[r.aG,"conditional"==e.row.ordType]]),(0,o.bo)((0,o.Lk)("span",Ke,"全部仓位",512),[[r.aG,"oco"==e.row.ordType]]),(0,o.bo)((0,o.Lk)("span",{class:"color-green"},(0,u.v_)(e.row.sz+"张"),513),[[r.aG,"move_order_stop"==e.row.ordType]]),(0,o.bo)((0,o.Lk)("span",{class:"color-green"},(0,u.v_)(e.row.sz+"张"),513),[[r.aG,"trigger"==e.row.ordType]])])),_:1}),(0,o.bF)(O,{prop:"callbackRatio",label:"回调幅度","min-width":"100",align:"center"},{default:(0,o.k6)((e=>[(0,o.bo)((0,o.Lk)("span",null,(0,u.v_)(""!=e.row.callbackRatio?"比例："+(100*e.row.callbackRatio).toFixed(1)+"%":"--"),513),[[r.aG,e.row.callbackRatio]]),(0,o.bo)((0,o.Lk)("span",null,(0,u.v_)("价距："+(""!=e.row.callbackSpread?e.row.callbackSpread:"--")),513),[[r.aG,e.row.callbackSpread]]),(0,o.bo)((0,o.Lk)("span",null,"--",512),[[r.aG,!(e.row.callbackRatio||e.row.callbackSpread)]])])),_:1}),(0,o.bF)(O,{prop:"moveTriggerPx",label:"止损触发价","min-width":"100",align:"center"},{default:(0,o.k6)((e=>[(0,o.bo)((0,o.Lk)("span",{class:(0,u.C4)(""!=e.row.moveTriggerPx?"color-red":"")},(0,u.v_)(""!=e.row.moveTriggerPx?(1*e.row.moveTriggerPx).toFixed(1):"--"),3),[[r.aG,"move_order_stop"==e.row.ordType]]),(0,o.bo)((0,o.Lk)("span",{class:(0,u.C4)(""!=e.row.slTriggerPx?"color-red":"")},(0,u.v_)(""!=e.row.slTriggerPx?(1*e.row.slTriggerPx).toFixed(1):"--"),3),[[r.aG,"conditional"==e.row.ordType||"oco"==e.row.ordType]]),(0,o.bo)((0,o.Lk)("span",We,(0,u.v_)("--"),512),[[r.aG,"trigger"==e.row.ordType]])])),_:1}),(0,o.bF)(O,{prop:"tpTriggerPx",label:"止盈触发价","min-width":"100",align:"center"},{default:(0,o.k6)((e=>[(0,o.bo)((0,o.Lk)("span",null,(0,u.v_)("--"),512),[[r.aG,"move_order_stop"==e.row.ordType]]),(0,o.bo)((0,o.Lk)("span",{class:(0,u.C4)(""!=e.row.tpTriggerPx?"color-green":"")},(0,u.v_)(""!=e.row.tpTriggerPx?(1*e.row.tpTriggerPx).toFixed(1):"--"),3),[[r.aG,"conditional"==e.row.ordType||"oco"==e.row.ordType]]),(0,o.bo)((0,o.Lk)("span",Ue,(0,u.v_)("--"),512),[[r.aG,"trigger"==e.row.ordType]])])),_:1}),(0,o.bF)(O,{prop:"activePx",label:"激活价格","min-width":"100",align:"center"},{default:(0,o.k6)((e=>[(0,o.bo)((0,o.Lk)("span",{class:(0,u.C4)(e.row.activePx?"color-green":"")},(0,u.v_)(e.row.activePx?e.row.activePx:"--"),3),[[r.aG,"trigger"!=e.row.ordType]]),(0,o.bo)((0,o.Lk)("span",{class:(0,u.C4)(e.row.triggerPx?"color-green":"")},(0,u.v_)(e.row.triggerPx?e.row.triggerPx:"--"),3),[[r.aG,"trigger"==e.row.ordType]])])),_:1}),(0,o.bF)(O,{prop:"state",label:"状态","min-width":"100",align:"center"},{default:(0,o.k6)((e=>[(0,o.bo)((0,o.Lk)("span",{class:(0,u.C4)(""!=e.row.moveTriggerPx?"color-green":"")},(0,u.v_)(""!=e.row.moveTriggerPx?"已激活":"未激活"),3),[[r.aG,"live"==e.row.state&&"move_order_stop"==e.row.ordType]]),(0,o.bo)((0,o.Lk)("span",{class:(0,u.C4)(""!=e.row.slTriggerPx||""!=e.row.tpTriggerPx?"color-green":"")},(0,u.v_)(""!=e.row.slTriggerPx||""!=e.row.tpTriggerPx?"已激活":"未激活"),3),[[r.aG,"live"==e.row.state&&("conditional"==e.row.ordType||"oco"==e.row.ordType)]]),(0,o.bo)((0,o.Lk)("span",Ge,(0,u.v_)("已激活"),512),[[r.aG,"live"==e.row.state&&"trigger"==e.row.ordType]])])),_:1}),(0,o.bF)(O,{prop:"",label:"操作",align:"center"},{default:(0,o.k6)((e=>[(0,o.bF)(g,{type:"danger",icon:"CircleClose",onClick:t=>n.doCancelAlgos(e.row)},{default:(0,o.k6)((()=>[(0,o.eW)("撤销")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])):(0,o.Q3)("",!0)])),_:1})])),_:1})]),(0,o.Lk)("div",null,[(0,o.bF)(x,{ref:"publicWsRef",type:"public",wsUrl:s.wsPublicUrl,logSwitch:a.openLogSwitch,onOpen:n.onOpen,onError:n.onError,onGetMessage:n.onMessage,onClose:n.onClose},null,8,["wsUrl","logSwitch","onOpen","onError","onGetMessage","onClose"]),(0,o.bF)(x,{ref:"privacyWsRef",type:"privacy",wsUrl:s.wsPrivacyUrl,logSwitch:a.openLogSwitch,onOpen:n.onOpen,onError:n.onError,onGetMessage:n.onMessage,onClose:n.onClose},null,8,["wsUrl","logSwitch","onOpen","onError","onGetMessage","onClose"]),(0,o.bF)(x,{ref:"businessWsRef",type:"business",wsUrl:s.wsBusinessUrl,logSwitch:a.openLogSwitch,onOpen:n.onOpen,onError:n.onError,onGetMessage:n.onMessage,onClose:n.onClose},null,8,["wsUrl","logSwitch","onOpen","onError","onGetMessage","onClose"])])])}s(9014);var Ne=s(4926),qe=s(7627),ze=s.n(qe),He={dateFormat:function(e,t){let s;const r={"Y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()};for(let o in r)s=new RegExp("("+o+")").exec(e),s&&(e=e.replace(s[1],1==s[1].length?r[o]:r[o].padStart(s[1].length,"0")));return e},uuid:function(){for(var e=[],t="0123456789abcdef",s=0;s<36;s++)e[s]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var r=e.join("");return r=r.replace(new RegExp("-","g"),""),r},copyValue:function(e,t){for(let s in t)e.hasOwnProperty(s)&&(t[s]=e[s])}},je=s(8442),Ye=s.n(je),Xe={baseUrl:{server:"http://154.92.14.87:18080/gate"}};const Je=Xe.baseUrl.server,Qe=Je;function Ze(e){this.f=e;var t=function(){Ye().interceptors.response.use((t=>(console.log("======================================",t),console.log("url路径:",t.config.url),"get"!=t.config.method&&console.log("请求参数:",t.config.data),console.log("请求结果:",t.data),console.log("======================================"),200==t.status?e(t):Promise.reject(t))),(e=>(console.log("错误信息:",e),Promise.reject(e))))};t()}function et(e,t={},s={}){return new Promise(((r,o)=>{try{Ye().get(e,{params:t,headers:s}).then((e=>{r(e.data)})).catch((e=>{console.log("get catch err1 : ",e),o(e)}))}catch(i){console.log("get catch err2 : ",i),o(i)}}))}function tt(e,t={},s={}){return new Promise(((r,o)=>{try{Ye().post(e,t,s).then((e=>{r(e.data)}),(e=>{console.log("post catch err1 : ",e),o(e)}))}catch(i){console.log("post catch err2 : ",i),o(i)}}))}Ye().defaults.timeout=3e4,Ye().defaults.baseURL=Qe,Ye().defaults.headers.common={"X-Requested-With":"XMLHttpRequest"},Ye().defaults.headers.post["Content-Type"]="application/json;charset=UTF-8",Ye().defaults.withCredentials=!0,Ye().interceptors.request.use((e=>e),(function(e){return Promise.reject(e)}));const st=(e,t,s)=>et(e,t,s),rt=(e,t,s)=>tt(e,t,s);var ot=s(7862),it=JSON.parse('{"real":{"wsPublicUrl":"wss://ws.okx.com:8443/ws/v5/public","wsPrivacyUrl":"wss://ws.okx.com:8443/ws/v5/private","wsBusinessUrl":"wss://ws.okx.com:8443/ws/v5/business"},"mock":{"wsPublicUrl":"wss://wspap.okx.com:8443/ws/v5/public","wsPrivacyUrl":"wss://wspap.okx.com:8443/ws/v5/private","wsBusinessUrl":"wss://wspap.okx.com:8443/ws/v5/business"},"defaultStrategy":{"BTC-USDT-SWAP":{"default":{"currentInstId":"BTC-USDT-SWAP","mgnMode":"isolated","exactTime":"","amount":0,"openOrderSwitch":true,"openSwitch":false,"currentTime":"","openDirection":0,"openType":1,"openMoveStopLossSwitch":true,"breakThroughDistance":"800","slTriggerPosition":1,"slTriggerPxDistance":"100","tpTriggerType":0,"tpTriggerPxDistance":"300","tpTriggerPxPercentage":"1","callback":0,"moveActiveUplRatio":"0","longCallbackRatio":"0.3","shortCallbackRatio":"0.3","longCallbackSpread":"200","shortCallbackSpread":"200","rollBackTimeInterval":300,"tpTriggerTimeInterval":600,"rollBackDirection":0}},"ETH-USDT-SWAP":{"default":{"currentInstId":"ETH-USDT-SWAP","mgnMode":"isolated","exactTime":"","amount":0,"openOrderSwitch":true,"openSwitch":false,"currentTime":"","openDirection":0,"openType":1,"openMoveStopLossSwitch":true,"breakThroughDistance":"40","slTriggerPosition":1,"slTriggerPxDistance":"5","tpTriggerType":0,"tpTriggerPxDistance":"15","tpTriggerPxPercentage":"1","callback":0,"moveActiveUplRatio":"0","longCallbackRatio":"0.3","shortCallbackRatio":"0.3","longCallbackSpread":"10","shortCallbackSpread":"10","rollBackTimeInterval":300,"tpTriggerTimeInterval":600,"rollBackDirection":0}}}}'),at={name:"tradepanel",components:{ElLoading:Ne.Ks,ElMessage:v.nk,ElMessageBox:C.s,ElNotification:w.df,websocket:B},props:{isDemoTrade:{type:Boolean},wsPublicUrl:{type:String},wsPrivacyUrl:{type:String},wsBusinessUrl:{type:String},name:{type:String},updateTime:{type:String},apiKey:{type:String},apiSecret:{type:String}},data(){return{firstLoad:!0,openLogSwitch:!1,last:"",availBal:"",accountConfig:{},leverConfig:{maxBuy:null,maxSell:null,longLever:null,shortLever:null},orderMap:new Map,delegateMap:new Map,form:{apiKey:"",apiSecret:"",passphrase:""},rules:{apiKey:[{required:!0,message:"请填写APIKey"}],apiSecret:[{required:!0,message:"请填写APISecret"}],passphrase:[{required:!0,message:"请填写APIKey的密码"}]},previousInstId:"BTC-USDT-SWAP",strategyForm:{currentInstId:"BTC-USDT-SWAP",mgnMode:"isolated",isDemoTrade:!0,exactTime:"",amount:0,openOrderSwitch:!0,openSwitch:!1,currentTime:"",openDirection:this.$constant.OpenDirection.BuyAndSell,openType:this.$constant.OpenType.ByManual,openMoveStopLossSwitch:!0,breakThroughDistance:"0",slTriggerPosition:this.$constant.TriggerPosition.FromForceClosePosition,slTriggerPxDistance:"0",tpTriggerType:this.$constant.TriggerType.ByPercentage,tpTriggerPxDistance:"0",tpTriggerPxPercentage:"0",callback:this.$constant.Callback.ByPercentage,moveActiveUplRatio:"0",longCallbackRatio:"0",shortCallbackRatio:"0",longCallbackSpread:"0",shortCallbackSpread:"0",rollBackTimeInterval:300,tpTriggerTimeInterval:0,rollBackDirection:0},strategyRules:{currentInstId:[{required:!0,message:"请选择交易产品"}],exactTime:[{required:!0,message:"请指定开单时间"}],amount:[{required:!0,message:"请填写开仓数量(张)"}],breakThroughDistance:[{required:!0,message:"请填写突破价"}],rollBackTimeInterval:[{required:!0,message:"请填写插针检测周期"}],tpTriggerTimeInterval:[{required:!0,message:"请填写插针止盈期限"}],rollBackDirection:[{required:!0,message:"请选择突破方向"}],slTriggerPosition:[{required:!0,message:"请选择初始止损触发位置"}],slTriggerPxDistance:[{required:!0,message:"请填写初始止损价距"}],tpTriggerType:[{required:!0,message:"请选择初始止盈触发类型"}],tpTriggerPxDistance:[{required:!0,message:"请填写止盈价距"}],tpTriggerPxPercentage:[{required:!0,message:"请填写止盈比例"}],moveActiveUplRatio:[{required:!0,message:"请填写移动止盈止损触发比例（收益率）"}],longCallbackRatio:[{required:!0,message:"请填写多单回调比例"}],shortCallbackRatio:[{required:!0,message:"请填写空单回调比例"}],longCallbackSpread:[{required:!0,message:"请填写多单回调价距"}],shortCallbackSpread:[{required:!0,message:"请填写空单回调价距"}]},pingPongTimer:null,tickTimer:null,wsPublicConnected:!1,wsPrivacyConnected:!1,wsBusinessConnected:!1,privacyLoginedFirst:!0,businessLoginedFirst:!0,privacyLogined:!1,businessLogined:!1,subscribedTickers:!1,subscribedAccount:!1,subscribedPositions:!1,subscribedOrders:!1,subscribedAlgoAdvance:!1,subscribedOrdersAlgo:!1,alreadyGotOrderAlgo:!1,requestingLongOrderAlgo:!1,requestingShortOrderAlgo:!1,requestingLongAlgoAdvance:!1,requestingShortAlgoAdvance:!1,peddingOrdersAlgoLoading:!1,triggerPeddingOrdersAlgoLoading:!1,cancelAlgosLoading:!1,closePositionLoadingCount:0,noAccountConfigCount:0}},created(){this.doInit(!0)},destroyed(){this.doDestroy()},computed:{orderList(){let e=[];return this.orderMap.forEach(((t,s)=>{e.push(t)})),e},delegateList(){let e=[];return this.delegateMap.forEach(((t,s)=>{e.push(t)})),e}},methods:{async doInit(e){this.strategyForm.isDemoTrade=this.isDemoTrade;let t=this.$ls.get(""+(this.apiKey+"_"+(this.isDemoTrade?"mock":"real")+"_passphrase"));if(!t)return void this.$router.go(-1);this.form.apiKey=this.apiKey,this.form.apiSecret=this.apiSecret,this.form.passphrase=t,this.readConfigData(),this.doTick(),this.startTickTimer();let s=Ne.Ks.service({fullscreen:!0,text:"初始化中..."});this.getAccountConfig((()=>{s.close(),this.accountConfig.uid&&(this.firstLoad=!1,this.getLeverageInfo(),this.getMaxSize(),e&&(this.openAllConnection(),this.startPingPongTimer()))}))},doDestroy(){this.destroyPingPongTimer(),this.destroyTickTimer(),this.confirmCancelSubscribe(),this.closeAllConnection(),this.logout()},startPingPongTimer(){this.pingPongTimer||(this.pingPongTimer=setInterval((()=>{this.doPingPong()}),25e3))},destroyPingPongTimer(){clearInterval(this.pingPongTimer),this.pingPongTimer=void 0},startTickTimer(){this.tickTimer||(this.tickTimer=setInterval((()=>{this.doTick()}),1e3))},destroyTickTimer(){clearInterval(this.tickTimer),this.tickTimer=void 0,this.strategyForm.currentTime=""},doPrivacyLogin(){this.$refs.formRef.validate((e=>{if(!e)return!1;this.confirmPrivacyLogin()}))},confirmPrivacyLogin(){if(!this.wsPrivacyConnected)return void(0,w.df)({message:"私有频道沿未连接！",type:"error",position:"top-right",duration:2e3});if(this.privacyLogined)return;const e=""+Date.now()/1e3;let t=ze().enc.Base64.stringify(ze().HmacSHA256(e+"GET/users/self/verify",this.form.apiSecret)),s={op:"login",args:[{apiKey:this.form.apiKey,passphrase:this.form.passphrase,timestamp:e,sign:t}]};this.$refs.privacyWsRef.send(JSON.stringify(s))},doBusinessLogin(){this.$refs.formRef.validate((e=>{if(!e)return!1;this.confirmBusinessLogin()}))},confirmBusinessLogin(){if(!this.wsBusinessConnected)return void(0,w.df)({message:"业务频道沿未连接！",type:"error",position:"top-right",duration:2e3});if(this.businessLogined)return;const e=""+Date.now()/1e3;let t=ze().enc.Base64.stringify(ze().HmacSHA256(e+"GET/users/self/verify",this.form.apiSecret)),s={op:"login",args:[{apiKey:this.form.apiKey,passphrase:this.form.passphrase,timestamp:e,sign:t}]};this.$refs.businessWsRef.send(JSON.stringify(s))},doPingPong(){this.wsPublicConnected&&this.$refs.publicWsRef.pingpong(),this.wsPrivacyConnected&&this.$refs.privacyWsRef.pingpong(),this.wsBusinessConnected&&this.$refs.businessWsRef.pingpong()},doTick(){if(!(this.accountConfig.uid||this.privacyLogined||this.businessLogined))return this.noAccountConfigCount++,void(this.noAccountConfigCount>=10&&(this.noAccountConfigCount=0,location.reload()));if(!this.accountConfig.uid||!this.privacyLogined||!this.businessLogined)return this.noAccountConfigCount++,void(this.noAccountConfigCount>=20&&(this.noAccountConfigCount=0,location.reload()));this.noAccountConfigCount=0;let e=new Date,t=parseInt(e.getTime()/1e3),s=e.toISOString().split(".")[0],r=He.dateFormat("YYYY-mm-dd HH:MM:SS",e);this.strategyForm.currentTime=r;let o="";if(this.strategyForm.openType==this.$constant.OpenType.ByTime||this.strategyForm.openType==this.$constant.OpenType.ByLimitBreakThrough)this.strategyForm.exactTime&&"string"==typeof this.strategyForm.exactTime?o=this.strategyForm.exactTime.split(".")[0]:this.strategyForm.exactTime&&(o=this.strategyForm.exactTime.toISOString().split(".")[0]);else if(this.strategyForm.openType==this.$constant.OpenType.ByBreakThroughThenRollback&&this.strategyForm.openSwitch&&this.strategyForm.rollBackTimeInterval>0&&t%this.strategyForm.rollBackTimeInterval==0){this.openLogSwitch&&console.log("插针回调检测 : ",t,this.strategyForm.rollBackTimeInterval,t%this.strategyForm.rollBackTimeInterval);let e=e=>{0==e&&this.doOpenOrder()};this.cancelRollbackStrategy(e)}this.strategyForm.openSwitch&&o&&s==o&&(console.log("==到达开单时间==",o,s),this.doOpenOrder())},privacyLoginSuccess(e,t){(0,w.df)({message:e,type:"success",position:"top-right",duration:2e3}),this.privacyLogined=!0,t&&(this.subscribeForPublic(),this.subscribeForPrivacy()),this.privacyLogined&&this.businessLogined&&this.getAccountConfig()},async businessLoginSuccess(e,t){(0,w.df)({message:e,type:"success",position:"top-right",duration:2e3}),this.businessLogined=!0,t&&(await this.subscribeForBusiness(),this.getPeddingOrdersAlgo()),this.privacyLogined&&this.businessLogined&&this.getAccountConfig()},openOrderSuccess(e,t,s){null!=s?setTimeout((()=>{(0,w.df)({message:e,type:t?"success":"error",position:"top-right",duration:2e3})}),250):(0,w.df)({message:e,type:t?"success":"error",position:"top-right",duration:2e3})},doCancelSubscribe(e){C.s.confirm("是否取消订阅？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{this.confirmCancelSubscribe(e)})).catch((()=>{}))},async confirmCancelSubscribe(e){await this.cancelSubscribeForPublic(e),await this.cancelSubscribeForPrivacy(e),this.cancelSubscribeForBusiness(e)},doReSubscribe(){C.s.confirm("是否重新订阅？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{this.confirmReSubscribe()})).catch((()=>{}))},confirmReSubscribe(){this.subscribeForPublic(),this.subscribeForPrivacy(),this.subscribeForBusiness()},confirmOpenOrder(){C.s.confirm("是否确认开单？","提示",{confirmButtonText:"确认开单",cancelButtonText:"取消",type:"warning"}).then((()=>{this.doOpenOrder()})).catch((()=>{}))},doOpenOrder(){if(!this.privacyLogined)return void(0,w.df)({message:"请先登录私有频道！",type:"warning",position:"top-right",duration:2e3});if(!this.businessLogined)return void(0,w.df)({message:"请先登录业务频道！",type:"warning",position:"top-right",duration:2e3});if(!this.strategyForm.openSwitch)return void(0,w.df)({message:"策略未开启！",type:"warning",position:"top-right",duration:2e3});if(!this.strategyForm.openOrderSwitch)return void(0,w.df)({message:"请先开启做单开关！",type:"warning",position:"top-right",duration:2e3});if(!this.checkAccountConfig())return;if(!this.checkMaxSize())return;let e=!1,t=!1;if(this.orderMap.forEach(((s,r)=>{"long"==s.posSide?e=!0:"short"==s.posSide&&(t=!0)})),this.strategyForm.openDirection==this.$constant.OpenDirection.BuyAndSell){if(e||t)return void(0,w.df)({message:"当前已存在【多空】单！",type:"warning",position:"top-right",duration:2e3});if(e)return void(0,w.df)({message:"当前已存在【多】单！",type:"warning",position:"top-right",duration:2e3});if(t)return void(0,w.df)({message:"当前已存在【空】单！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlyBuy){if(e)return void(0,w.df)({message:"当前已存在【多】单！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlySell&&t)return void(0,w.df)({message:"当前已存在【空】单！",type:"warning",position:"top-right",duration:2e3});if(this.delegateMap.size>0){let s=!1,r=!1,o=!1,i=!1;if(this.delegateMap.forEach(((e,t)=>{let a=e.ordType,n=e.side,l=e.posSide;"buy"==n&&"short"==l?r=!0:"sell"==n&&"long"==l&&(s=!0),"trigger"==a&&("buy"==n&&"long"==l?o=!0:"sell"==n&&"short"==l&&(i=!0))})),this.strategyForm.openType==this.$constant.OpenType.ByLimitBreakThrough){if(o||i)return void(0,w.df)({message:"当前存在突破委托策略，请先撤销！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openType==this.$constant.OpenType.ByBreakThroughThenRollback&&(o||i))return void(0,w.df)({message:"当前存在插针回调委托策略，请先撤销！",type:"warning",position:"top-right",duration:2e3});if(this.strategyForm.openDirection==this.$constant.OpenDirection.BuyAndSell){if(!e&&!t&&(s||r))return void(0,w.df)({message:"当前存在止盈止损策略，请先撤销！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlyBuy){if(!e&&s)return void(0,w.df)({message:"当前存在[多]单止盈止损策略，请先撤销！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlySell&&!t&&r)return void(0,w.df)({message:"当前存在[空]单止盈止损策略，请先撤销！",type:"warning",position:"top-right",duration:2e3})}if(this.strategyForm.openType==this.$constant.OpenType.ByBreakThroughThenRollback){if(""==this.strategyForm.rollBackTimeInterval||parseInt(this.strategyForm.rollBackTimeInterval)<=0)return void(0,w.df)({message:"请填写插针检测周期，需>0！",type:"warning",position:"top-right",duration:2e3});if(""==this.strategyForm.tpTriggerTimeInterval||parseInt(this.strategyForm.tpTriggerTimeInterval)<0)return void(0,w.df)({message:"请填写插针止盈期限，需>=0！",type:"warning",position:"top-right",duration:2e3})}if(this.strategyForm.openMoveStopLossSwitch){if(""==this.strategyForm.slTriggerPxDistance||parseFloat(this.strategyForm.slTriggerPxDistance)<0)return void(0,w.df)({message:"请填写止损价距，需>0！",type:"warning",position:"top-right",duration:2e3});if(0==this.strategyForm.tpTriggerTimeInterval)if(this.strategyForm.tpTriggerType==this.$constant.TriggerType.ByDistance){if(""==this.strategyForm.tpTriggerPxDistance||parseFloat(this.strategyForm.tpTriggerPxDistance)<0)return void(0,w.df)({message:"请填写止盈价距，需>0！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.tpTriggerType==this.$constant.TriggerType.ByPercentage&&(""==this.strategyForm.tpTriggerPxPercentage||parseFloat(this.strategyForm.tpTriggerPxPercentage)<0))return void(0,w.df)({message:"请填写止盈比例，1位小数！",type:"warning",position:"top-right",duration:2e3});if(""==this.strategyForm.moveActiveUplRatio)return void(0,w.df)({message:"请填写移动止盈止损触发比例（收益率），2位小数！",type:"warning",position:"top-right",duration:2e3});if(this.strategyForm.callback==this.$constant.Callback.ByPercentage){if(this.strategyForm.openDirection==this.$constant.OpenDirection.BuyAndSell){if(""==this.strategyForm.longCallbackRatio||parseInt(10*this.strategyForm.longCallbackRatio)/10<0)return void(0,w.df)({message:"请填写多单回调比例，1位小数！",type:"warning",position:"top-right",duration:2e3});if(""==this.strategyForm.shortCallbackRatio||parseInt(10*this.strategyForm.shortCallbackRatio)/10<0)return void(0,w.df)({message:"请填写空单回调比例，1位小数！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlyBuy){if(""==this.strategyForm.longCallbackRatio||parseInt(10*this.strategyForm.longCallbackRatio)/10<0)return void(0,w.df)({message:"请填写多单回调比例，1位小数！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlySell&&(""==this.strategyForm.shortCallbackRatio||parseInt(10*this.strategyForm.shortCallbackRatio)/10<0))return void(0,w.df)({message:"请填写空单回调比例，1位小数！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.callback==this.$constant.Callback.ByDistance)if(this.strategyForm.openDirection==this.$constant.OpenDirection.BuyAndSell){if(""==this.strategyForm.longCallbackSpread||parseFloat(this.strategyForm.longCallbackSpread)<0)return void(0,w.df)({message:"请填写多单回调价距，需>0！",type:"warning",position:"top-right",duration:2e3});if(""==this.strategyForm.shortCallbackSpread||parseFloat(this.strategyForm.shortCallbackSpread)<0)return void(0,w.df)({message:"请填写空单回调价距，需>0！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlyBuy){if(""==this.strategyForm.longCallbackSpread||parseFloat(this.strategyForm.longCallbackSpread)<0)return void(0,w.df)({message:"请填写多单回调价距，需>0！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlySell&&(""==this.strategyForm.shortCallbackSpread||parseFloat(this.strategyForm.shortCallbackSpread)<0))return void(0,w.df)({message:"请填写空单回调价距，需>0！",type:"warning",position:"top-right",duration:2e3})}if(this.strategyForm.openType==this.$constant.OpenType.ByTime||this.strategyForm.openType==this.$constant.OpenType.ByManual)this.strategyForm.openDirection==this.$constant.OpenDirection.BuyAndSell?this.batchOpenOrder("buyAndSell",this.strategyForm.amount):this.strategyForm.openDirection==this.$constant.OpenDirection.OnlyBuy?this.openOrder("buy",this.strategyForm.amount):this.strategyForm.openDirection==this.$constant.OpenDirection.OnlySell&&this.openOrder("sell",this.strategyForm.amount);else if(this.strategyForm.openType==this.$constant.OpenType.ByLimitBreakThrough)this.openLimitOrder("buy",this.strategyForm.amount),this.openLimitOrder("sell",this.strategyForm.amount);else if(this.strategyForm.openType==this.$constant.OpenType.ByBreakThroughThenRollback){let e=this.getTriggerDelegateCount();if(e>2)return;this.openRollbackOrder("buy",this.strategyForm.amount),this.openRollbackOrder("sell",this.strategyForm.amount)}},openLimitOrder(e,t){if(!(""!=this.last&&parseFloat(this.last)>0))return;let s="";"buy"==e?(this.requestingLongOrderAlgo=!0,s=(parseFloat(this.last)+parseFloat(this.strategyForm.breakThroughDistance)).toFixed(1)):(this.requestingShortOrderAlgo=!0,s=(parseFloat(this.last)-parseFloat(this.strategyForm.breakThroughDistance)).toFixed(1));const r=""+(new Date).toISOString();let o={instId:this.strategyForm.currentInstId,tdMode:this.strategyForm.mgnMode,ordType:"trigger",side:e,posSide:"buy"==e?"long":"short",triggerPxType:"last",triggerPx:s,orderPx:"-1",sz:t},i=JSON.stringify(o),a=this.$api.ORDER_ALGO,n=ze().enc.Base64.stringify(ze().HmacSHA256(r+"POST"+a+i,this.form.apiSecret)),l={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":r,"OK-ACCESS-SIGN":n};this.strategyForm.isDemoTrade&&(l["x-simulated-trading"]=1),rt(a,{body:i},{headers:l}).then((t=>{let s=t.code;if(1e3==s){let s=t.data;if(s){let t=JSON.parse(s);"0"==t.code?(0,w.df)({message:`添加${"buy"==e?"多单":"空单"}突破委托策略成功！`,type:"success",position:"top-right",duration:2e3}):(0,w.df)({message:`添加${"buy"==e?"多单":"空单"}突破委托策略失败！`,type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:`添加${"buy"==e?"多单":"空单"}突破委托策略失败！`,type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:`添加${"long"==posSide?"多单":"空单"}突破委托策略失败！`,type:"error",position:"top-right",duration:2e3});this.getTriggerPeddingOrdersAlgo(),setTimeout((()=>{"buy"==e?this.requestingLongOrderAlgo=!1:this.requestingShortOrderAlgo=!1}),2e3)})).catch((t=>{"buy"==e?this.requestingLongOrderAlgo=!1:this.requestingShortOrderAlgo=!1,(0,w.df)({message:`添加${"buy"==e?"多单":"空单"}突破委托策略调用异常！`,type:"error",position:"top-right",duration:2e3})}))},cancelRollbackStrategy(e){0!=this.orderMap.size||0!=this.delegateMap.size?0==this.orderMap.size&&this.cancelRollbackOrder(e):this.getPeddingRollbackOrdersAlgo(e)},openRollbackOrder(e,t){if(!(""!=this.last&&parseFloat(this.last)>0))return;let s="";this.strategyForm.rollBackDirection==this.$constant.RollBackDirection.Homeopathy?"buy"==e?(this.requestingLongOrderAlgo=!0,s=(parseFloat(this.last)+parseFloat(this.strategyForm.breakThroughDistance)).toFixed(1)):(this.requestingShortOrderAlgo=!0,s=(parseFloat(this.last)-parseFloat(this.strategyForm.breakThroughDistance)).toFixed(1)):"buy"==e?(this.requestingLongOrderAlgo=!0,s=(parseFloat(this.last)-parseFloat(this.strategyForm.breakThroughDistance)).toFixed(1)):(this.requestingShortOrderAlgo=!0,s=(parseFloat(this.last)+parseFloat(this.strategyForm.breakThroughDistance)).toFixed(1));const r=""+(new Date).toISOString();let o={instId:this.strategyForm.currentInstId,tdMode:this.strategyForm.mgnMode,ordType:"trigger",side:e,posSide:"buy"==e?"long":"short",triggerPxType:"last",triggerPx:s,orderPx:"-1",sz:t},i=JSON.stringify(o),a=this.$api.ORDER_ALGO,n=ze().enc.Base64.stringify(ze().HmacSHA256(r+"POST"+a+i,this.form.apiSecret)),l={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":r,"OK-ACCESS-SIGN":n};this.strategyForm.isDemoTrade&&(l["x-simulated-trading"]=1),rt(a,{body:i},{headers:l}).then((t=>{let s=t.code;if(1e3==s){let s=t.data;if(s){let t=JSON.parse(s);"0"==t.code?(0,w.df)({message:`添加${"buy"==e?"多单":"空单"}插针回调委托策略成功！`,type:"success",position:"top-right",duration:2e3}):(0,w.df)({message:`添加${"buy"==e?"多单":"空单"}插针回调委托策略失败！`,type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:`添加${"buy"==e?"多单":"空单"}插针回调委托策略失败！`,type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:`添加${"long"==posSide?"多单":"空单"}插针回调委托策略失败！`,type:"error",position:"top-right",duration:2e3});this.getTriggerPeddingOrdersAlgo(),setTimeout((()=>{"buy"==e?this.requestingLongOrderAlgo=!1:this.requestingShortOrderAlgo=!1}),2e3)})).catch((t=>{"buy"==e?this.requestingLongOrderAlgo=!1:this.requestingShortOrderAlgo=!1,(0,w.df)({message:`添加${"buy"==e?"多单":"空单"}插针回调委托策略调用异常！`,type:"error",position:"top-right",duration:2e3})}))},openOrder(e,t){let s=He.dateFormat("YYYYmmddHHMMSS",new Date),r=He.uuid(),o="sell"==e?r.substr(0,r.length-4)+"sell":r.substr(0,r.length-3)+"buy",i={id:r,op:"order",args:[{clOrdId:o,side:e,posSide:"buy"==e?"long":"short",instId:this.strategyForm.currentInstId,tdMode:this.strategyForm.mgnMode,ordType:"market",sz:t,tag:s}]};this.$refs.privacyWsRef.send(JSON.stringify(i))},batchOpenOrder(e,t){let s=[];"buyAndSell"==e?(s.push("buy"),s.push("sell")):"buy"==e?s.push("buy"):"sell"==e&&s.push("sell");let r=He.uuid(),o={id:r,op:s.length>1?"batch-orders":"order",args:[]},i=He.dateFormat("YYYYmmddHHMMSS",new Date);for(let a=0;a<s.length;a++){let e=s[a],n="sell"==e?r.substr(0,r.length-4)+"sell":r.substr(0,r.length-3)+"buy",l={clOrdId:n,side:e,posSide:"buy"==e?"long":"short",instId:this.strategyForm.currentInstId,tdMode:this.strategyForm.mgnMode,ordType:"market",sz:t,tag:i};o.args.push(l)}this.$refs.privacyWsRef.send(JSON.stringify(o))},getTriggerDelegateCount(){this.delegateMap.forEach(((e,t)=>{let s=e.ordType,r=e.side,o=e.posSide;"trigger"==s&&("buy"==r&&"long"==o||"sell"==r&&"short"==o)&&0}))},doCancelAllAlgos(){C.s.confirm("确认撤销全部策略？","提示",{confirmButtonText:"确认撤销",cancelButtonText:"取消",type:"warning"}).then((()=>{this.confirmCancelAllAlgos()})).catch((()=>{}))},doCancelAlgos(e){C.s.confirm("确认撤销该策略？","提示",{confirmButtonText:"确认撤销",cancelButtonText:"取消",type:"warning"}).then((()=>{this.confirmCancelAlgos(e,!0)})).catch((()=>{}))},confirmCancelAllAlgos(){if(this.cancelAlgosLoading)return;this.cancelAlgosLoading=!0;let e=Ne.Ks.service({fullscreen:!0,text:"正在撤销中..."});const t=""+(new Date).toISOString();let s=[];this.delegateMap.forEach(((e,t)=>{s.push({algoId:e.algoId,instId:this.strategyForm.currentInstId})}));let r=JSON.stringify(s),o=this.$api.CANCEL_ALGOS,i=ze().enc.Base64.stringify(ze().HmacSHA256(t+"POST"+o+r,this.form.apiSecret)),a={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":t,"OK-ACCESS-SIGN":i};this.strategyForm.isDemoTrade&&(a["x-simulated-trading"]=1),rt(o,{body:r},{headers:a}).then((t=>{e.close();let s=t.code;if(1e3==s){let e=t.data;if(e){let t=JSON.parse(e);if("0"==t.code)(0,w.df)({message:"撤销成功！",type:"success",position:"top-right",duration:2e3});else if("1"==t.code){let e=!1,s=t.data;for(let t=0;s&&t<s.length;t++){let r=s[t].sCode,o=s[t].algoId;"51400"==r&&this.delegateMap.has(o)&&(this.delegateMap.delete(o),e=!0)}e?(0,w.df)({message:"委托单已不存在，撤销成功！",type:"success",position:"top-right",duration:2e3}):(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3});this.cancelAlgosLoading=!1,this.getPeddingOrdersAlgo()})).catch((t=>{e.close(),(0,w.df)({message:"撤销调用异常！",type:"error",position:"top-right",duration:2e3}),this.cancelAlgosLoading=!1}))},confirmCancelAlgos(e,t,s){if(this.cancelAlgosLoading)return;this.cancelAlgosLoading=!0;let r=null;t&&(r=Ne.Ks.service({fullscreen:!0,text:"正在撤销中..."}));const o=""+(new Date).toISOString();let i=[{algoId:e.algoId,instId:this.strategyForm.currentInstId}],a=JSON.stringify(i),n=this.$api.CANCEL_ALGOS,l=ze().enc.Base64.stringify(ze().HmacSHA256(o+"POST"+n+a,this.form.apiSecret)),g={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":o,"OK-ACCESS-SIGN":l};this.strategyForm.isDemoTrade&&(g["x-simulated-trading"]=1),rt(n,{body:a},{headers:g}).then((s=>{t&&r.close();let o=!1,i=s.code;if(1e3==i){let t=s.data;if(t){let s=JSON.parse(t);if("0"==s.code)o=!0,(0,w.df)({message:"撤销成功！",type:"success",position:"top-right",duration:2e3}),this.delegateMap.delete(e.algoId);else if("1"==s.code){let t=s.data;for(let s=0;t&&s<t.length;s++){let r=t[s].sCode;"51400"==r&&this.delegateMap.has(e.algoId)&&(this.delegateMap.delete(e.algoId),o=!0)}o?(0,w.df)({message:"委托单已不存在，撤销成功！",type:"success",position:"top-right",duration:2e3}):(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3});this.cancelAlgosLoading=!1,this.getPeddingOrdersAlgo()})).catch((e=>{console.log("err : ",e),t&&r.close(),(0,w.df)({message:"撤销调用异常！",type:"error",position:"top-right",duration:2e3}),this.cancelAlgosLoading=!1}))},confirmCancelRollbackAlgos(e,t){const s=""+(new Date).toISOString();let r=[{algoId:e.algoId,instId:this.strategyForm.currentInstId}],o=JSON.stringify(r),i=this.$api.CANCEL_ALGOS,a=ze().enc.Base64.stringify(ze().HmacSHA256(s+"POST"+i+o,this.form.apiSecret)),n={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":s,"OK-ACCESS-SIGN":a};this.strategyForm.isDemoTrade&&(n["x-simulated-trading"]=1),rt(i,{body:o},{headers:n}).then((s=>{let r=!1,o=s.code;if(1e3==o){let t=s.data;if(t){let s=JSON.parse(t);if("0"==s.code)r=!0,(0,w.df)({message:"撤销成功！",type:"success",position:"top-right",duration:2e3}),this.delegateMap.delete(e.algoId);else if("1"==s.code){let t=s.data;for(let s=0;t&&s<t.length;s++){let o=t[s].sCode;"51400"==o&&this.delegateMap.has(e.algoId)&&(this.delegateMap.delete(e.algoId),r=!0)}r?(0,w.df)({message:"委托单已不存在，撤销成功！",type:"success",position:"top-right",duration:2e3}):(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"撤销失败！",type:"error",position:"top-right",duration:2e3});this.getPeddingRollbackOrdersAlgo(t)})).catch((e=>{console.log("err : ",e),showLoading&&loading.close(),(0,w.df)({message:"撤销调用异常！",type:"error",position:"top-right",duration:2e3})}))},doOpenConditionalStopLoss(e,t,s,r){this.openConditionalStopLoss(e,t,s,r)},openConditionalStopLoss(e,t,s,r){"long"==t?this.requestingLongOrderAlgo=!0:this.requestingShortOrderAlgo=!0;const o=""+(new Date).toISOString();let i={instId:this.strategyForm.currentInstId,tdMode:this.strategyForm.mgnMode,side:e,posSide:t,cxlOnClosePos:!0,reduceOnly:!0,closeFraction:"1"};""!=s&&(i.slTriggerPx=s,i.slTriggerPxType="last",i.slOrdPx="-1"),""!=r&&(i.tpTriggerPx=r,i.tpTriggerPxType="last",i.tpOrdPx="-1"),i.ordType=""!=s&&""!=r?"oco":"conditional";let a=JSON.stringify(i),n=this.$api.ORDER_ALGO,l=ze().enc.Base64.stringify(ze().HmacSHA256(o+"POST"+n+a,this.form.apiSecret)),g={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":o,"OK-ACCESS-SIGN":l};this.strategyForm.isDemoTrade&&(g["x-simulated-trading"]=1),rt(n,{body:a},{headers:g}).then((e=>{let s=e.code;if(1e3==s){let t=e.data;if(t){let e=JSON.parse(t);"0"==e.code?(0,w.df)({message:`添加${"oco"==i.ordType?"双向":"单向"}止盈止损策略成功！`,type:"success",position:"top-right",duration:2e3}):(0,w.df)({message:`添加${"oco"==i.ordType?"双向":"单向"}止盈止损策略失败！`,type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:`添加${"oco"==i.ordType?"双向":"单向"}止盈止损策略失败！`,type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:`添加${"oco"==i.ordType?"双向":"单向"}止盈止损策略失败！`,type:"error",position:"top-right",duration:2e3});setTimeout((()=>{"long"==t?this.requestingLongOrderAlgo=!1:this.requestingShortOrderAlgo=!1}),2e3)})).catch((e=>{"long"==t?this.requestingLongOrderAlgo=!1:this.requestingShortOrderAlgo=!1,(0,w.df)({message:`添加${"oco"==i.ordType?"双向":"单向"}止盈止损策略调用异常！`,type:"error",position:"top-right",duration:2e3})}))},doOpenMoveStopLoss(e,t,s,r,o){this.openMoveStopLoss(e,t,s,r,o)},openMoveStopLoss(e,t,s,r,o){"long"==t?this.requestingLongAlgoAdvance=!0:this.requestingShortAlgoAdvance=!0;const i=""+(new Date).toISOString();let a={instId:this.strategyForm.currentInstId,tdMode:this.strategyForm.mgnMode,ordType:"move_order_stop",side:e,posSide:t,sz:s};null!=r&&(a.callbackRatio=parseInt(10*r)/10/100),null!=o&&(a.callbackSpread=o);let n=JSON.stringify(a),l=this.$api.ORDER_ALGO,g=ze().enc.Base64.stringify(ze().HmacSHA256(i+"POST"+l+n,this.form.apiSecret)),d={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":i,"OK-ACCESS-SIGN":g};this.strategyForm.isDemoTrade&&(d["x-simulated-trading"]=1),rt(l,{body:n},{headers:d}).then((e=>{let s=e.code;if(1e3==s){let t=e.data;if(t){let e=JSON.parse(t);"0"==e.code?(0,w.df)({message:"添加移动止盈止损策略成功！",type:"success",position:"top-right",duration:2e3}):(0,w.df)({message:"添加移动止盈止损策略失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"添加移动止盈止损策略失败！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"添加移动止盈止损策略失败！",type:"error",position:"top-right",duration:2e3});setTimeout((()=>{"long"==t?this.requestingLongAlgoAdvance=!1:this.requestingShortAlgoAdvance=!1}),2e3)})).catch((e=>{"long"==t?this.requestingLongAlgoAdvance=!1:this.requestingShortAlgoAdvance=!1,(0,w.df)({message:"添加移动止盈止损策略调用异常！",type:"error",position:"top-right",duration:2e3})}))},doCloseAllOrders(){C.s.confirm("确认全部平仓？","提示",{confirmButtonText:"确认平仓",cancelButtonText:"取消",type:"warning"}).then((()=>{this.confirmCloseAllOrders()})).catch((()=>{}))},doCloseOrder(e){C.s.confirm("确认市价平仓？","提示",{confirmButtonText:"确认平仓",cancelButtonText:"取消",type:"warning"}).then((()=>{this.confirmCloseOrder(e,!0)})).catch((()=>{}))},confirmCloseAllOrders(){let e=Ne.Ks.service({fullscreen:!0,text:"正在平仓中..."});this.closePositionLoadingCount=0;let t=this.orderMap.size,s=()=>{this.closePositionLoadingCount++,this.closePositionLoadingCount>=t&&e.close()};this.orderMap.forEach(((e,t)=>{this.confirmCloseOrder(e,!1,s)}))},confirmCloseOrder(e,t,s){let r=null;t&&(r=Ne.Ks.service({fullscreen:!0,text:"正在平仓中..."}));const o=""+(new Date).toISOString();let i={instId:e.instId,posSide:e.posSide,mgnMode:e.mgnMode,autoCxl:!0},a=JSON.stringify(i),n=this.$api.CLOSE_POSITION,l=ze().enc.Base64.stringify(ze().HmacSHA256(o+"POST"+n+a,this.form.apiSecret)),g={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":o,"OK-ACCESS-SIGN":l};this.strategyForm.isDemoTrade&&(g["x-simulated-trading"]=1),rt(n,{body:a},{headers:g}).then((o=>{t&&r.close(),s&&s();let i=o.code;if(1e3==i){let t=o.data;if(t){let s=JSON.parse(t);"0"==s.code?(0,w.df)({message:`平仓成功[${"long"==e.posSide?"多单":"空单"}]！`,type:"success",position:"top-right",duration:2e3}):(0,w.df)({message:`平仓失败[${"long"==e.posSide?"多单":"空单"}]！`,type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:`平仓失败[${"long"==e.posSide?"多单":"空单"}]！`,type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:`平仓失败[${"long"==e.posSide?"多单":"空单"}]！`,type:"error",position:"top-right",duration:2e3})})).catch((o=>{t&&r.close(),s&&s(),(0,w.df)({message:`平仓调用异常[${"long"==e.posSide?"多单":"空单"}]！`,type:"error",position:"top-right",duration:2e3})}))},async doRefreshPositions(){this.orderMap.clear(),await this.cancelSubscribeForPrivacy(),this.subscribeForPrivacy()},async doRefreshAlgoAdvance(){this.delegateMap.clear(),await this.cancelSubscribeForBusiness(),await this.subscribeForBusiness(),this.getPeddingOrdersAlgo()},subscribeForPublic(){let e={op:"subscribe",args:[{channel:"tickers",instType:"SWAP",instId:this.strategyForm.currentInstId,extraParams:'{"updateInterval":"250"}'}]};this.$refs.publicWsRef.send(JSON.stringify(e))},cancelSubscribeForPublic(e){let t={op:"unsubscribe",args:[{channel:"tickers",instType:"SWAP",instId:e||this.strategyForm.currentInstId}]};this.$refs.publicWsRef.send(JSON.stringify(t)),this.subscribedTickers=!1},subscribeForPrivacy(){let e={op:"subscribe",args:[{channel:"account",instType:"SWAP",instId:this.strategyForm.currentInstId},{channel:"positions",instType:"SWAP",instId:this.strategyForm.currentInstId,extraParams:'{"updateInterval":"2000"}'},{channel:"orders",instType:"SWAP",instId:this.strategyForm.currentInstId}]};this.$refs.privacyWsRef.send(JSON.stringify(e))},cancelSubscribeForPrivacy(e){let t={op:"unsubscribe",args:[{channel:"account",instType:"SWAP",instId:e||this.strategyForm.currentInstId},{channel:"positions",instType:"SWAP",instId:e||this.strategyForm.currentInstId},{channel:"orders",instType:"SWAP",instId:e||this.strategyForm.currentInstId}]};this.$refs.privacyWsRef.send(JSON.stringify(t)),this.subscribedAccount=!1,this.subscribedPositions=!1,this.subscribedOrders=!1},subscribeForBusiness(){let e={op:"subscribe",args:[{channel:"algo-advance",instType:"SWAP",instId:this.strategyForm.currentInstId},{channel:"orders-algo",instType:"SWAP",instId:this.strategyForm.currentInstId}]};this.$refs.businessWsRef.send(JSON.stringify(e)),this.delegateMap.clear()},cancelSubscribeForBusiness(e){let t={op:"unsubscribe",args:[{channel:"algo-advance",instType:"SWAP",instId:e||this.strategyForm.currentInstId},{channel:"orders-algo",instType:"SWAP",instId:this.strategyForm.currentInstId}]};this.$refs.businessWsRef.send(JSON.stringify(t)),this.subscribedAlgoAdvance=!1,this.subscribedOrdersAlgo=!1,this.alreadyGotOrderAlgo=!1,this.delegateMap.clear()},handleTickers(e){if(e.data){let t=e.data[0];this.last=t.last}},handleAccount(e){if(e.data&&e.data.length>0&&e.data[0].details&&e.data[0].details.length>0)for(let t=0;t<e.data[0].details.length;t++){let s=e.data[0].details[t].ccy;if("USDT"==s){this.availBal=e.data[0].details[t].availBal;break}}},handlePositions(e){if(e.data){let t=this.orderMap.size,s=[],r=this.orderMap.keys(),o="";for(let i=0;i<e.data.length;i++){let t=e.data[i],r=t.instId;if(r==this.strategyForm.currentInstId){let e=t.avgPx;if(""!=e){let e=r+"_"+t.posId;s.push(e),this.orderMap.set(e,{instId:t.instId,posId:t.posId,tradeId:t.tradeId,availPos:t.availPos,posSide:t.posSide,mgnMode:t.mgnMode,mgnRatio:t.mgnRatio,avgPx:t.avgPx,uplLastPx:t.uplLastPx,uplRatio:t.uplRatio,ccy:t.ccy,lever:t.lever,liqPx:t.liqPx,markPx:t.markPx,last:t.last,algoId:t.algoId,cTime:He.dateFormat("YYYY-mm-dd HH:MM:SS",new Date(parseInt(t.cTime))),refreshTime:He.dateFormat("YYYY-mm-dd HH:MM:SS",new Date)}),o?o+="\n"+t.instId+"_下["+("short"==t.posSide?"空":"多")+"]单成功，开仓均价："+t.avgPx+"，数量："+t.availPos:o=t.instId+"_下["+("short"==t.posSide?"空":"多")+"]单成功，开仓均价："+t.avgPx+"，数量："+t.availPos}}}for(const e of r)-1==s.indexOf(e)&&this.orderMap.delete(e);t!=this.orderMap.size&&(this.getMaxSize(),this.getPeddingOrdersAlgo(),0==t&&""!=o&&(this.strategyForm.openType!=this.$constant.OpenType.ByTime&&this.strategyForm.openType!=this.$constant.OpenType.ByLimitBreakThrough&&this.strategyForm.openType!=this.$constant.OpenType.ByBreakThroughThenRollback||(o+="\n开单方式："+(this.strategyForm.openType==this.$constant.OpenType.ByTime?"定时开单":this.strategyForm.openType==this.$constant.OpenType.ByLimitBreakThrough?"突破挂单":"插针回调"),this.sendOrderSuccessMail(this.strategyForm.currentInstId,o)))),this.orderMap.size>0&&(this.cancelLimitOrder(),this.checkAlgoAndMake())}},handleAlgoAdvance(e){if(e.data){for(let t=0;t<e.data.length;t++){let s=e.data[t],r=s.instId;if(r==this.strategyForm.currentInstId){let e=s.ordType;if("move_order_stop"==e){let e="buy"==s.side&&"short"==s.posSide||"sell"==s.side&&"long"==s.posSide;if(e){let t=s.state,r=s.algoId;"live"==t?this.delegateMap.set(r,{instId:s.instId,algoId:s.algoId,ordType:s.ordType,side:s.side,posSide:s.posSide,tdMode:s.tdMode,lever:s.lever,sz:s.sz,callbackRatio:s.callbackRatio,callbackSpread:s.callbackSpread,moveTriggerPx:s.moveTriggerPx,triggerPx:s.triggerPx,activePx:s.activePx,state:s.state,isClose:e}):this.delegateMap.delete(r)}}else if("trigger"==e){let e=s.state,t=s.algoId;"live"==e?this.delegateMap.set(t,{instId:s.instId,algoId:s.algoId,ordType:s.ordType,side:s.side,posSide:s.posSide,tdMode:s.tdMode,lever:s.lever,sz:s.sz,callbackRatio:s.callbackRatio,callbackSpread:s.callbackSpread,moveTriggerPx:s.moveTriggerPx,triggerPx:s.triggerPx,activePx:s.activePx,state:s.state,isClose:!1}):this.delegateMap.delete(t)}}}this.alreadyGotOrderAlgo=!0}},handleOrdersAlgo(e){if(e.data){for(let t=0;t<e.data.length;t++){let s=e.data[t],r=s.instId;if(r==this.strategyForm.currentInstId){let e=s.ordType;if("conditional"==e||"oco"==e){let e="buy"==s.side&&"short"==s.posSide||"sell"==s.side&&"long"==s.posSide;if(e){let t=s.state,r=s.algoId;"live"==t?this.delegateMap.set(r,{instId:s.instId,algoId:s.algoId,ordType:s.ordType,side:s.side,posSide:s.posSide,tdMode:s.tdMode,lever:s.lever,sz:s.sz,slTriggerPx:s.slTriggerPx,slTriggerPxType:s.slTriggerPxType,tpTriggerPx:s.tpTriggerPx,tpTriggerPxType:s.tpTriggerPxType,triggerPx:s.triggerPx,actualSide:s.actualSide,activePx:s.activePx,state:s.state,isClose:e}):this.delegateMap.delete(r)}}else if("trigger"==e){let e=s.state,t=s.algoId;"live"==e?this.delegateMap.set(t,{instId:s.instId,algoId:s.algoId,ordType:s.ordType,side:s.side,posSide:s.posSide,tdMode:s.tdMode,lever:s.lever,sz:s.sz,slTriggerPx:s.slTriggerPx,slTriggerPxType:s.slTriggerPxType,tpTriggerPx:s.tpTriggerPx,tpTriggerPxType:s.tpTriggerPxType,triggerPx:s.triggerPx,actualSide:s.actualSide,activePx:s.activePx,state:s.state,isClose:!1}):this.delegateMap.delete(t)}}}this.alreadyGotOrderAlgo=!0}},cancelLimitOrder(){if(!this.strategyForm.openSwitch)return;if(0==this.orderMap.size)return;if(0==this.delegateMap.size)return;if(this.triggerPeddingOrdersAlgoLoading)return;let e=!1,t=!1;this.orderMap.forEach(((s,r)=>{let o=s.posSide;"long"==o?e=!0:"short"==o&&(t=!0)}));let s=null,r=null;this.delegateMap.forEach(((e,t)=>{let o=e.side,i=e.posSide,a=e.ordType;"trigger"==a&&("buy"==o&&"long"==i?s=e:"sell"==o&&"short"==i&&(r=e))})),e&&null!=r?this.confirmCancelAlgos(r,!1):t&&null!=s&&this.confirmCancelAlgos(s,!1)},cancelRollbackOrder(e){if(!this.strategyForm.openSwitch)return;let t=null,s=null;this.delegateMap.forEach(((e,r)=>{let o=e.side,i=e.posSide,a=e.ordType;"trigger"==a&&("buy"==o&&"long"==i?t=e:"sell"==o&&"short"==i&&(s=e))})),null!=s&&null!=t?(this.confirmCancelRollbackAlgos(s,null),this.confirmCancelRollbackAlgos(t,e)):null!=s&&null==t?this.confirmCancelRollbackAlgos(s,e):null!=t&&null==s&&this.confirmCancelRollbackAlgos(t,e)},checkAlgoAndMake(){if(this.strategyForm.openSwitch&&0!=this.orderMap.size&&!this.peddingOrdersAlgoLoading&&this.alreadyGotOrderAlgo){let e=!1,t=!1,s=null,r=null,o=null,i=null,a=null,n=null,l=null,g=null,d=null,c=null;if(this.orderMap.forEach(((p,h)=>{let u=p.posSide,y=p.cTime;if("long"==u){if(e=!0,s=p.avgPx,a=p.availPos,o=p.liqPx,l=p.uplRatio,this.strategyForm.tpTriggerTimeInterval>0){let e=new Date(y).getTime(),t=(new Date).getTime();t>=e+1e3*parseInt(this.strategyForm.tpTriggerTimeInterval)&&100*l>=.1&&(d=p)}}else if("short"==u&&(t=!0,r=p.avgPx,n=p.availPos,i=p.liqPx,g=p.uplRatio,this.strategyForm.tpTriggerTimeInterval>0)){let e=new Date(y).getTime(),t=(new Date).getTime();t>=e+1e3*parseInt(this.strategyForm.tpTriggerTimeInterval)&&100*g>=.1&&(c=p)}})),null!=d||null!=c)return null!=d&&this.confirmCloseOrder(d,!1),void(null!=c&&this.confirmCloseOrder(c,!1));if(!this.strategyForm.openMoveStopLossSwitch)return;let p=!1,h=!1,u=!1,y=!1;this.delegateMap.forEach(((s,r)=>{let o=s.side,i=s.posSide,a=s.ordType;"buy"==o&&"short"==i?t&&("conditional"==a||"oco"==a?u=!0:"move_order_stop"==a&&(y=!0)):"sell"==o&&"long"==i&&e&&("conditional"==a||"oco"==a?p=!0:"move_order_stop"==a&&(h=!0))})),e&&(p||this.requestingLongOrderAlgo||this.doRequestingOrderAlgo("sell","long",s,o,null,null,"conditionalOrOco"),h||this.requestingLongAlgoAdvance||this.doRequestingOrderAlgo("sell","long",null,null,a,l,"move_order_stop")),t&&(u||this.requestingShortOrderAlgo||this.doRequestingOrderAlgo("buy","short",r,i,null,null,"conditionalOrOco"),y||this.requestingShortAlgoAdvance||this.doRequestingOrderAlgo("buy","short",null,null,n,g,"move_order_stop"))}},doRequestingOrderAlgo(e,t,s,r,o,i,a){if("conditionalOrOco"==a){if(this.strategyForm.slTriggerPxDistance>0||this.strategyForm.tpTriggerPxPercentage>0||this.strategyForm.tpTriggerPxDistance>0){let o="",i="";if("long"==t?(this.strategyForm.slTriggerPxDistance>0&&(this.strategyForm.slTriggerPosition==this.$constant.TriggerPosition.FromOpenPosition?o=(parseFloat(s)-parseFloat(this.strategyForm.slTriggerPxDistance)).toFixed(1):this.strategyForm.slTriggerPosition==this.$constant.TriggerPosition.FromForceClosePosition&&(o=(parseFloat(r)+parseFloat(this.strategyForm.slTriggerPxDistance)).toFixed(1))),this.strategyForm.tpTriggerType==this.$constant.TriggerType.ByDistance?this.strategyForm.tpTriggerPxDistance>0&&(i=(parseFloat(s)+parseFloat(this.strategyForm.tpTriggerPxDistance)).toFixed(1)):this.strategyForm.tpTriggerType==this.$constant.TriggerType.ByPercentage&&this.strategyForm.tpTriggerPxPercentage>0&&(i=(parseFloat(s)+parseFloat(s)*parseFloat(this.strategyForm.tpTriggerPxPercentage)/100).toFixed(1))):(this.strategyForm.slTriggerPxDistance>0&&(this.strategyForm.slTriggerPosition==this.$constant.TriggerPosition.FromOpenPosition?o=(parseFloat(s)+parseFloat(this.strategyForm.slTriggerPxDistance)).toFixed(1):this.strategyForm.slTriggerPosition==this.$constant.TriggerPosition.FromForceClosePosition&&(o=(parseFloat(r)-parseFloat(this.strategyForm.slTriggerPxDistance)).toFixed(1))),this.strategyForm.tpTriggerType==this.$constant.TriggerType.ByDistance?this.strategyForm.tpTriggerPxDistance>0&&(i=(parseFloat(s)-parseFloat(this.strategyForm.tpTriggerPxDistance)).toFixed(1)):this.strategyForm.tpTriggerType==this.$constant.TriggerType.ByPercentage&&this.strategyForm.tpTriggerPxPercentage>0&&(i=(parseFloat(s)-parseFloat(s)*parseFloat(this.strategyForm.tpTriggerPxPercentage)/100).toFixed(1))),""==o&&""==i)return;this.doOpenConditionalStopLoss(e,t,o,i)}}else if("move_order_stop"==a){let s=null,r=null;if(parseFloat(this.strategyForm.moveActiveUplRatio)>0&&100*i>=parseFloat(this.strategyForm.moveActiveUplRatio)||parseFloat(this.strategyForm.moveActiveUplRatio)<=0){if(this.strategyForm.callback==this.$constant.Callback.ByPercentage){if(s="long"==t?this.strategyForm.longCallbackRatio:this.strategyForm.shortCallbackRatio,s<=0)return}else if(this.strategyForm.callback==this.$constant.Callback.ByDistance&&(r="long"==t?this.strategyForm.longCallbackSpread:this.strategyForm.shortCallbackSpread,r<=0))return;this.doOpenMoveStopLoss(e,t,o,s,r)}}},async onOpen(e){let t=e.type;"public"==t?(this.openLogSwitch&&console.log("==公共频道socket连接成功=="),this.wsPublicConnected=!0):"privacy"==t?(this.openLogSwitch&&console.log("==私有频道socket连接成功=="),this.wsPrivacyConnected=!0,this.privacyLogined&&(this.subscribeForPublic(),this.subscribeForPrivacy()),this.privacyLoginedFirst&&(this.doPrivacyLogin(),this.privacyLoginedFirst=!1)):"business"==t&&(this.openLogSwitch&&console.log("==业务频道socket连接成功=="),this.wsBusinessConnected=!0,this.businessLogined&&(await this.subscribeForBusiness(),this.getPeddingOrdersAlgo()),this.businessLoginedFirst&&(this.doBusinessLogin(),this.businessLoginedFirst=!1))},onMessage(e){let t=e.type,s=e.response;if(this.openLogSwitch&&console.log("接收到数据：",t,s),"public"==t){let e=s.event,t=s.arg;if("subscribe"==e){if(t){let e=t.channel;"tickers"==e&&(this.subscribedTickers=!0,this.last="")}}else if("unsubscribe"==e){if(t){let e=t.channel;"tickers"==e&&(this.subscribedTickers=!1,this.last="")}}else if(t){let e=t.channel,r=t.instId;if("tickers"==e&&r==this.strategyForm.currentInstId)return void this.handleTickers(s)}}else if("privacy"==t){let e=s.event,t=s.arg;if("subscribe"==e){if(t){let e=t.channel;"account"==e?this.subscribedAccount=!0:"positions"==e?(this.subscribedPositions=!0,this.orderMap.clear()):"orders"==e&&(this.subscribedOrders=!0)}}else if("unsubscribe"==e){if(t){let e=t.channel;"account"==e?this.subscribedAccount=!1:"positions"==e?(this.subscribedPositions=!1,this.orderMap.clear()):"orders"==e&&(this.subscribedOrders=!1)}}else if(t){let e=t.channel,r=t.instId;if("account"==e)this.handleAccount(s);else if("positions"==e&&r==this.strategyForm.currentInstId)return void this.handlePositions(s)}}else if("business"==t){let e=s.event,t=s.arg;if("subscribe"==e){if(t){let e=t.channel;"algo-advance"==e?this.subscribedAlgoAdvance=!0:"orders-algo"==e&&(this.subscribedOrdersAlgo=!0)}}else if("unsubscribe"==e){if(t){let e=t.channel;"algo-advance"==e?this.subscribedAlgoAdvance=!1:"orders-algo"==e&&(this.subscribedOrdersAlgo=!1)}}else if(t){let e=t.channel,r=t.instId;if("algo-advance"==e){if(r==this.strategyForm.currentInstId)return void this.handleAlgoAdvance(s)}else if("orders-algo"==e&&r==this.strategyForm.currentInstId)return void this.handleOrdersAlgo(s)}}let r=s.code,o=s.event,i=s.op;if(0==r){if("login"==o)"privacy"==t?this.privacyLoginSuccess("私有频道登录成功！",!0):"business"==t&&this.businessLoginSuccess("业务频道登录成功！",!0);else if("order"==i){let e=s.data;if(e&&e.length>0){let t=e[0].clOrdId,s=e[0].ordId;s&&this.openOrderSuccess("开["+(-1!=t.indexOf("buy")?"多":"空")+"]单成功！",!0,null)}}else if("batch-orders"==i){let e=s.data;if(e&&e.length>0)for(let t=0;t<e.length;t++){let s=e[t].clOrdId,r=e[t].ordId;r?this.openOrderSuccess("开["+(-1!=s.indexOf("buy")?"多":"空")+"]单成功！",!0,t==e.length-1):this.openOrderSuccess("开"+(-1!=s.indexOf("buy")?"多":"空")+"单失败！",!1,t==e.length-1)}}}else if("login"==i)60031==r&&("privacy"==t?this.privacyLoginSuccess("私有频道当前已登录！",!1):"business"==t&&this.businessLoginSuccess("业务频道当前已登录！",!1));else if("order"==i){if(1==r){let e=s.data;if(e&&e.length>0){let t=e[0].clOrdId,s=e[0].ordId;s||this.openOrderSuccess("开"+(-1!=t.indexOf("buy")?"多":"空")+"单失败！",!1,null)}}}else if("batch-orders"==i&&1==r){let e=s.data;if(e&&e.length>0)for(let t=0;t<e.length;t++){let s=e[t].clOrdId,r=e[t].ordId;r||this.openOrderSuccess("开"+(-1!=s.indexOf("buy")?"多":"空")+"单失败！",!1,t==e.length-1)}}},onError(e){let t=e.type;"public"==t?(this.openLogSwitch&&console.log("==公共频道socket连接失败=="),this.wsPublicConnected=!1,this.$refs.publicWsRef.close()):"privacy"==t?(this.openLogSwitch&&console.log("==私有频道socket连接失败=="),this.wsPrivacyConnected=!1,this.$refs.privacyWsRef.close()):"business"==t&&(this.openLogSwitch&&console.log("==业务频道socket连接失败=="),this.wsBusinessConnected=!1,this.$refs.businessWsRef.close())},onClose(e){let t=e.type;"public"==t?this.openLogSwitch&&console.log("==公共频道socket已经关闭=="):"privacy"==t&&this.openLogSwitch&&console.log("==私有频道socket已经关闭=="),this.resetAllState()},openAllConnection(){this.$refs.publicWsRef.init(),this.$refs.privacyWsRef.init(),this.$refs.businessWsRef.init()},closeAllConnection(){this.$refs.publicWsRef.closeAndBack(),this.$refs.privacyWsRef.closeAndBack(),this.$refs.businessWsRef.closeAndBack(),this.resetAllState()},resetAllState(){this.privacyLogined=!1,this.businessLogined=!1,this.wsPublicConnected=!1,this.wsPrivacyConnected=!1,this.wsBusinessConnected=!1,this.subscribedTickers=!1,this.subscribedAccount=!1,this.subscribedPositions=!1,this.subscribedOrders=!1,this.subscribedAlgoAdvance=!1,this.subscribedOrdersAlgo=!1,this.alreadyGotOrderAlgo=!1,this.requestingLongOrderAlgo=!1,this.requestingLongAlgoAdvance=!1,this.requestingShortOrderAlgo=!1,this.requestingShortAlgoAdvance=!1,this.accountConfig={},this.leverConfig={maxBuy:null,maxSell:null,longLever:null,shortLever:null},this.last="",this.openedOrder=[],this.delegateMap.clear(),this.peddingOrdersAlgoLoading=!1,this.triggerPeddingOrdersAlgoLoading=!1},resetAllSubscribeState(){this.subscribedTickers=!1,this.subscribedAccount=!1,this.subscribedPositions=!1,this.subscribedOrders=!1,this.subscribedAlgoAdvance=!1,this.subscribedOrdersAlgo=!1,this.alreadyGotOrderAlgo=!1,this.requestingLongOrderAlgo=!1,this.requestingLongAlgoAdvance=!1,this.requestingShortOrderAlgo=!1,this.requestingShortAlgoAdvance=!1,this.leverConfig={maxBuy:null,maxSell:null,longLever:null,shortLever:null},this.last="",this.openedOrder=[],this.delegateMap.clear(),this.peddingOrdersAlgoLoading=!1,this.triggerPeddingOrdersAlgoLoading=!1},logout(){this.$ls.set(""+(this.form.apiKey+"_"+(this.isDemoTrade?"mock":"real")+"_passphrase"),""),this.$ls.set(""+(this.form.apiKey+"_"+(this.isDemoTrade?"mock":"real")+"_openSwitch"),!1)},handleOpenTypeChanged(e){this.strategyForm.openType==this.$constant.OpenType.ByLimitBreakThrough&&this.strategyForm.tpTriggerType==this.$constant.TriggerType.ByPercentage&&(this.strategyForm.tpTriggerType,this.$constant.TriggerType.ByDistance)},handleTpTriggerTypeChanged(e){this.strategyForm.openType==this.$constant.OpenType.ByLimitBreakThrough&&this.strategyForm.tpTriggerType==this.$constant.TriggerType.ByPercentage&&(this.strategyForm.tpTriggerType,this.$constant.TriggerType.ByDistance)},async handleOpenSwitchChanged(e){if(this.strategyForm.openSwitch){if(!this.checkAccountConfig())return void(this.strategyForm.openSwitch=!1);if(this.strategyForm.openType==this.$constant.OpenType.ByTime&&""==this.strategyForm.exactTime)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"开单时间必须设置！",type:"warning",position:"top-right",duration:2e3});if(parseInt(this.strategyForm.amount)<=0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"开仓数量(张)必须大于0！",type:"warning",position:"top-right",duration:2e3});if(await this.getMaxSize(),!this.checkMaxSize())return void(this.strategyForm.openSwitch=!1);if(this.delegateMap.size>0){let e=!1,t=!1;this.orderMap.forEach(((s,r)=>{"long"==s.posSide?e=!0:"short"==s.posSide&&(t=!0)}));let s=!1,r=!1;if(this.delegateMap.forEach(((e,t)=>{let o=e.side,i=e.posSide;"buy"==o&&"short"==i?r=!0:"sell"==o&&"long"==i&&(s=!0)})),this.strategyForm.openDirection==this.$constant.OpenDirection.BuyAndSell){if(!e&&!t&&(s||r))return void(0,w.df)({message:"当前存在止盈止损策略，请先撤销！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlyBuy){if(!e&&s)return void(0,w.df)({message:"当前存在[多]单止盈止损策略，请先撤销！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlySell&&!t&&r)return void(0,w.df)({message:"当前存在[空]单止盈止损策略，请先撤销！",type:"warning",position:"top-right",duration:2e3})}if((this.strategyForm.openType==this.$constant.OpenType.ByLimitBreakThrough||this.strategyForm.openType==this.$constant.OpenType.ByBreakThroughThenRollback)&&(""==this.strategyForm.breakThroughDistance||parseFloat(this.strategyForm.breakThroughDistance)<=0))return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写突破价距，需>0！",type:"warning",position:"top-right",duration:2e3});if(this.strategyForm.openType==this.$constant.OpenType.ByBreakThroughThenRollback){if(""==this.strategyForm.rollBackTimeInterval||parseInt(this.strategyForm.rollBackTimeInterval)<=0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写插针检测周期，需>0！",type:"warning",position:"top-right",duration:2e3});if(""==this.strategyForm.tpTriggerTimeInterval||parseInt(this.strategyForm.tpTriggerTimeInterval)<0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写插针止盈期限，需>=0！",type:"warning",position:"top-right",duration:2e3})}if(this.strategyForm.openMoveStopLossSwitch){if(""==this.strategyForm.slTriggerPxDistance||parseFloat(this.strategyForm.slTriggerPxDistance)<0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写初始止损价距，需>0！",type:"warning",position:"top-right",duration:2e3});if(this.strategyForm.tpTriggerType==this.$constant.TriggerType.ByDistance){if(""==this.strategyForm.tpTriggerPxDistance||parseFloat(this.strategyForm.tpTriggerPxDistance)<0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写止盈价距，需>0！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.tpTriggerType==this.$constant.TriggerType.ByPercentage&&(""==this.strategyForm.tpTriggerPxPercentage||parseFloat(this.strategyForm.tpTriggerPxPercentage)<0))return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写止盈比例，1位小数！",type:"warning",position:"top-right",duration:2e3});if(""==this.strategyForm.moveActiveUplRatio)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写移动止盈止损触发比例（收益率），2位小数！",type:"warning",position:"top-right",duration:2e3});if(this.strategyForm.callback==this.$constant.Callback.ByPercentage){if(this.strategyForm.openDirection==this.$constant.OpenDirection.BuyAndSell){if(""==this.strategyForm.longCallbackRatio||parseInt(10*this.strategyForm.longCallbackRatio)/10<0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写多单回调比例，1位小数！",type:"warning",position:"top-right",duration:2e3});if(""==this.strategyForm.shortCallbackRatio||parseInt(10*this.strategyForm.shortCallbackRatio)/10<0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写空单回调比例，1位小数！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlyBuy){if(""==this.strategyForm.longCallbackRatio||parseInt(10*this.strategyForm.longCallbackRatio)/10<0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写多单回调比例，1位小数！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlySell&&(""==this.strategyForm.shortCallbackRatio||parseInt(10*this.strategyForm.shortCallbackRatio)/10<0))return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写空单回调比例，1位小数！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.callback==this.$constant.Callback.ByDistance)if(this.strategyForm.openDirection==this.$constant.OpenDirection.BuyAndSell){if(""==this.strategyForm.longCallbackSpread||parseFloat(this.strategyForm.longCallbackSpread)<0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写多单回调价距，需>0！",type:"warning",position:"top-right",duration:2e3});if(""==this.strategyForm.shortCallbackSpread||parseFloat(this.strategyForm.shortCallbackSpread)<0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写空单回调价距，需>0！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlyBuy){if(""==this.strategyForm.longCallbackSpread||parseFloat(this.strategyForm.longCallbackSpread)<0)return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写多单回调价距，需>0！",type:"warning",position:"top-right",duration:2e3})}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlySell&&(""==this.strategyForm.shortCallbackSpread||parseFloat(this.strategyForm.shortCallbackSpread)<0))return this.strategyForm.openSwitch=!1,void(0,w.df)({message:"请填写空单回调价距，需>0！",type:"warning",position:"top-right",duration:2e3})}this.saveConfigData()}if(setTimeout((()=>{(0,w.df)({message:this.strategyForm.openSwitch?"策略已开启！":"策略已关闭！",type:"success",position:"top-right",duration:1e3})}),500),this.$ls.set(""+(this.form.apiKey+"_"+(this.isDemoTrade?"mock":"real")+"_openSwitch"),this.strategyForm.openSwitch),this.strategyForm.openSwitch&&this.strategyForm.openType==this.$constant.OpenType.ByBreakThroughThenRollback&&this.strategyForm.rollBackTimeInterval>0&&(this.openLogSwitch&&console.log("插针回调初始检测 : ",nowTimeSeconds,this.strategyForm.rollBackTimeInterval,nowTimeSeconds%this.strategyForm.rollBackTimeInterval),0==this.orderMap.size&&0==this.delegateMap.size&&!this.triggerPeddingOrdersAlgoLoading)){let e=e=>{0==e&&this.doOpenOrder()};this.getPeddingRollbackOrdersAlgo(e)}},async handleInstIdChanged(e){await this.confirmCancelSubscribe(this.previousInstId),await this.resetAllSubscribeState(),this.destroyTickTimer(),this.subscribeForPrivacy(),this.subscribeForPublic(),this.subscribeForBusiness(),this.getPeddingOrdersAlgo(),this.doInit(!1),this.previousInstId=this.strategyForm.currentInstId},async handleMgnModeChanged(e){this.getPeddingOrdersAlgo(),this.getLeverageInfo(),this.getMaxSize()},checkAccountConfig(){return this.accountConfig.uid?"2"!=this.accountConfig.acctLv&&"3"!=this.accountConfig.acctLv?((0,w.df)({message:"当前帐户层级不为[单币种保证金模式/跨币种保证金模式]！",type:"warning",position:"top-right",duration:2e3}),!1):"long_short_mode"==this.accountConfig.posMode||((0,w.df)({message:"当前持仓方式不为[开平仓模式]！",type:"warning",position:"top-right",duration:2e3}),!1):((0,w.df)({message:"未获取到当前的帐户配置，请联系管理员！",type:"warning",position:"top-right",duration:2e3}),!1)},checkMaxSize(){let e=!1,t=!1;if(this.orderMap.forEach(((s,r)=>{"long"==s.posSide?e=!0:"short"==s.posSide&&(t=!0)})),this.strategyForm.openDirection==this.$constant.OpenDirection.BuyAndSell){if(!e&&!t){if(parseInt(this.leverConfig.maxBuy)-2*parseInt(this.strategyForm.amount)<0||parseInt(this.leverConfig.maxSell)-2*parseInt(this.strategyForm.amount)<0)return this.strategyForm.openSwitch=!1,(0,w.df)({message:"开仓数量(张)已超过最大可开单数量！",type:"warning",position:"top-right",duration:2e3}),!1;if(parseInt(this.strategyForm.amount)>parseInt(this.leverConfig.maxBuy))return this.strategyForm.openSwitch=!1,(0,w.df)({message:"开仓数量(张)已超过最大可开多数量！",type:"warning",position:"top-right",duration:2e3}),!1;if(parseInt(this.strategyForm.amount)>parseInt(this.leverConfig.maxSell))return this.strategyForm.openSwitch=!1,(0,w.df)({message:"开仓数量(张)已超过最大可开空数量！",type:"warning",position:"top-right",duration:2e3}),!1}}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlyBuy){if(!e&&parseInt(this.strategyForm.amount)>parseInt(this.leverConfig.maxBuy))return this.strategyForm.openSwitch=!1,(0,w.df)({message:"开仓数量(张)已超过最大可开多数量！",type:"warning",position:"top-right",duration:2e3}),!1}else if(this.strategyForm.openDirection==this.$constant.OpenDirection.OnlySell&&!t&&parseInt(this.strategyForm.amount)>parseInt(this.leverConfig.maxSell))return this.strategyForm.openSwitch=!1,(0,w.df)({message:"开仓数量(张)已超过最大可开空数量！",type:"warning",position:"top-right",duration:2e3}),!1;return!0},readConfigData(){let e=this.$ls.get(""+(this.form.apiKey+"_"+(this.isDemoTrade?"mock":"real")+"_"+this.strategyForm.currentInstId+"_configData"));null!=e?(e.isDemoTrade=this.isDemoTrade,He.copyValue(e,this.strategyForm)):it.defaultStrategy&&it.defaultStrategy.default&&it.defaultStrategy[this.strategyForm.currentInstId].default&&(e=it.defaultStrategy[this.strategyForm.currentInstId].default,null!=e&&(e.isDemoTrade=this.isDemoTrade,He.copyValue(e,this.strategyForm)));let t=this.$ls.get(""+(this.form.apiKey+"_"+(this.isDemoTrade?"mock":"real")+"_openSwitch"));null!=t&&(this.strategyForm.openSwitch=t)},saveConfigData(){let e=JSON.parse(JSON.stringify(this.strategyForm));return e.openSwitch=!1,this.$ls.set(""+(this.form.apiKey+"_"+(this.isDemoTrade?"mock":"real")+"_"+this.strategyForm.currentInstId+"_configData"),e),(0,w.df)({message:"已保存配置参数！",type:"success",position:"top-right",duration:1e3}),e},loadConfigData(e,t){let s={0:e};return this.readConfigContent(s),!1},readConfigContent(e){if(0==e.length)return;if(!/\.(dat)$/.test(e[0].name.toLowerCase()))return void(0,w.df)({message:"配置文件格式有误，请选择正确的配置文件.dat！",type:"error",position:"top-right",duration:2e3});const t=new FileReader;t.onload=e=>{try{let t=e.target.result,s=JSON.parse(t);s&&s.currentInstId?(s.isDemoTrade=this.isDemoTrade,s.currentInstId==this.strategyForm.currentInstId?He.copyValue(s,this.strategyForm):(0,w.df)({message:"当前产品的配置文件，请选择正确的配置文件.dat！",type:"error",position:"top-right",duration:2e3})):(0,w.df)({message:"配置文件内容有误，请选择正确的配置文件.dat！",type:"error",position:"top-right",duration:2e3})}catch(t){(0,w.df)({message:"读取配置文件出错，请选择正确的配置文件.dat！",type:"error",position:"top-right",duration:2e3})}},t.readAsText(e[0],"UTF-8")},saveConfigDataToFile(){let e=this.saveConfigData();const t=new Blob([JSON.stringify(e)],{type:"text/plain;charset=utf-8"});(0,ot.saveAs)(t,`${this.strategyForm.currentInstId}_配置参数（${e.isDemoTrade?"模拟交易":"实盘交易"}）.dat`)},resetConfigData(){if(this.$ls.set(""+(this.form.apiKey+"_"+(this.isDemoTrade?"mock":"real")+"_"+this.strategyForm.currentInstId+"_configData"),null),it.defaultStrategy&&it.defaultStrategy.default&&it.defaultStrategy[this.strategyForm.currentInstId].default){let e=it.defaultStrategy[this.strategyForm.currentInstId].default;null!=e&&(e.isDemoTrade=this.isDemoTrade,He.copyValue(e,this.strategyForm))}},handleCommand(e){"a"==e?this.resetConfigData():"b"==e?this.saveConfigData():"c"==e?this.$refs.uploadRef.$el.click():"d"==e&&this.saveConfigDataToFile()},getAccountConfig(e){const t=""+(new Date).toISOString();let s="",r=this.$api.ACCOUNT_CONFIG,o=ze().enc.Base64.stringify(ze().HmacSHA256(t+"GET"+r+s,this.form.apiSecret)),i={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":t,"OK-ACCESS-SIGN":o};this.strategyForm.isDemoTrade&&(i["x-simulated-trading"]=1),st(r,{},i).then((t=>{let s=t.code;if(1e3==s){let e=t.data;if(e){let t=JSON.parse(e);"0"==t.code?this.accountConfig=t.data[0]:"50105"==t.code?C.s.alert("密码不正确，请返回重新输入密码！","提示",{confirmButtonText:"返回"}).then((()=>{this.$router.go(-1)})):((0,w.df)({message:"获取不到帐户配置！",type:"error",position:"top-right",duration:2e3}),this.accountConfig={})}else(0,w.df)({message:"获取不到帐户配置！",type:"error",position:"top-right",duration:2e3}),this.accountConfig={}}else(0,w.df)({message:t.message,type:"error",position:"top-right",duration:2e3}),this.accountConfig={};e&&e()})).catch((t=>{console.log("err : ",t),(0,w.df)({message:"获取帐户配置调用异常！",type:"error",position:"top-right",duration:2e3}),this.accountConfig={},e&&e()}))},getLeverageInfo(){const e=""+(new Date).toISOString();let t=this.$api.LEVERAGE_INFO,s=t+"?instId="+this.strategyForm.currentInstId+"&mgnMode="+this.strategyForm.mgnMode,r="",o=ze().enc.Base64.stringify(ze().HmacSHA256(e+"GET"+s+r,this.form.apiSecret)),i={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":e,"OK-ACCESS-SIGN":o};this.strategyForm.isDemoTrade&&(i["x-simulated-trading"]=1),st(s,{},i).then((e=>{let t=e.code;if(1e3==t){let t=e.data;if(t){let e=JSON.parse(t);if("0"==e.code){let t=e.data;for(let e=0;t&&e<t.length;e++){t[e].mgnMode;let s=t[e].posSide,r=t[e].lever;"long"==s?this.leverConfig.longLever=r:"short"==s&&(this.leverConfig.shortLever=r)}}else(0,w.df)({message:"获取不到杠杆倍数信息！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"获取不到杠杆倍数信息！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:e.message,type:"error",position:"top-right",duration:2e3})})).catch((e=>{(0,w.df)({message:"获取杠杆倍数信息调用失败！",type:"error",position:"top-right",duration:2e3})}))},async getMaxSize(){try{const e=""+(new Date).toISOString();let t=this.$api.MAX_SIZE,s=t+"?instId="+this.strategyForm.currentInstId+"&tdMode="+this.strategyForm.mgnMode,r="",o=ze().enc.Base64.stringify(ze().HmacSHA256(e+"GET"+s+r,this.form.apiSecret)),i={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":e,"OK-ACCESS-SIGN":o};this.strategyForm.isDemoTrade&&(i["x-simulated-trading"]=1);let a=await st(s,{},i),n=a.code;if(1e3==n){let e=a.data;if(e){let t=JSON.parse(e);if("0"==t.code){let e=t.data;for(let t=0;e&&t<e.length;t++){let s=e[t].maxBuy,r=e[t].maxSell;this.leverConfig.maxBuy=s,this.leverConfig.maxSell=r}}else(0,w.df)({message:"获取不到最大可买卖/开仓数量！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"获取不到最大可买卖/开仓数量！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:a.message,type:"error",position:"top-right",duration:2e3})}catch(e){console.log("err : ",e),(0,w.df)({message:"获取最大可买卖/开仓数量调用失败！",type:"error",position:"top-right",duration:2e3})}},getPeddingOrdersAlgo(){this.getConditionalAndOcoPeddingOrdersAlgo(),this.getTriggerPeddingOrdersAlgo()},getPeddingRollbackOrdersAlgo(e){this.getTriggerPeddingOrdersAlgo(e)},getConditionalAndOcoPeddingOrdersAlgo(){this.peddingOrdersAlgoLoading=!0;const e=""+(new Date).toISOString();let t=this.$api.ORDERS_ALGO_PENDING,s=t+"?instId="+this.strategyForm.currentInstId+"&ordType=conditional,oco",r="",o=ze().enc.Base64.stringify(ze().HmacSHA256(e+"GET"+s+r,this.form.apiSecret)),i={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":e,"OK-ACCESS-SIGN":o};this.strategyForm.isDemoTrade&&(i["x-simulated-trading"]=1),st(s,{},i).then((e=>{let t=e.code;if(1e3==t){let t=e.data;if(t){let e=JSON.parse(t);if("0"==e.code){let t=e.data;for(let e=0;e<t.length;e++){let s=t[e],r=s.instId;if(r==this.strategyForm.currentInstId){let e=s.ordType;if("conditional"==e||"oco"==e){let e="buy"==s.side&&"short"==s.posSide||"sell"==s.side&&"long"==s.posSide;if(e){let t=s.state,r=s.algoId;"live"==t?this.delegateMap.set(r,{instId:s.instId,algoId:s.algoId,ordType:s.ordType,side:s.side,posSide:s.posSide,tdMode:s.tdMode,lever:s.lever,sz:s.sz,slTriggerPx:s.slTriggerPx,slTriggerPxType:s.slTriggerPxType,tpTriggerPx:s.tpTriggerPx,tpTriggerPxType:s.tpTriggerPxType,triggerPx:s.triggerPx,actualSide:s.actualSide,activePx:s.activePx,state:s.state,isClose:e}):this.delegateMap.delete(r)}}}}this.alreadyGotOrderAlgo=!0}else(0,w.df)({message:"获取不到未完成的策略委托单信息！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"获取不到未完成的策略委托单信息！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:e.message,type:"error",position:"top-right",duration:2e3});this.peddingOrdersAlgoLoading=!1})).catch((e=>{(0,w.df)({message:"获取未完成的策略委托单信息调用失败！",type:"error",position:"top-right",duration:2e3}),this.peddingOrdersAlgoLoading=!1}))},getTriggerPeddingOrdersAlgo(e){this.triggerPeddingOrdersAlgoLoading=!0;const t=""+(new Date).toISOString();let s=this.$api.ORDERS_ALGO_PENDING,r=s+"?instId="+this.strategyForm.currentInstId+"&ordType=trigger",o="",i=ze().enc.Base64.stringify(ze().HmacSHA256(t+"GET"+r+o,this.form.apiSecret)),a={"Content-Type":"application/json","OK-ACCESS-KEY":this.form.apiKey,"OK-ACCESS-PASSPHRASE":this.form.passphrase,"OK-ACCESS-TIMESTAMP":t,"OK-ACCESS-SIGN":i};this.strategyForm.isDemoTrade&&(a["x-simulated-trading"]=1),st(r,{},a).then((t=>{let s=t.code;if(1e3==s){let s=t.data;if(s){let t=JSON.parse(s);if("0"==t.code){let s=t.data,r=0,o=this.delegateMap.keys();for(const e of o){let t=this.delegateMap.get(e);"trigger"==t.ordType&&this.delegateMap.delete(e)}for(let e=0;e<s.length;e++){let t=s[e],o=t.instId;if(o==this.strategyForm.currentInstId){t.ordType;let e=t.state,s=t.algoId;"live"==e&&(r++,this.delegateMap.set(s,{instId:t.instId,algoId:t.algoId,ordType:t.ordType,side:t.side,posSide:t.posSide,tdMode:t.tdMode,lever:t.lever,sz:t.sz,slTriggerPx:t.slTriggerPx,slTriggerPxType:t.slTriggerPxType,tpTriggerPx:t.tpTriggerPx,tpTriggerPxType:t.tpTriggerPxType,triggerPx:t.triggerPx,actualSide:t.actualSide,activePx:t.activePx,state:t.state,isClose:!1}))}}e&&e(r)}else(0,w.df)({message:"获取不到未完成的计划委托单信息！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:"获取不到未完成的计划委托单信息！",type:"error",position:"top-right",duration:2e3})}else(0,w.df)({message:t.message,type:"error",position:"top-right",duration:2e3});this.triggerPeddingOrdersAlgoLoading=!1})).catch((e=>{(0,w.df)({message:"获取未完成的计划委托单信息调用失败！",type:"error",position:"top-right",duration:2e3}),this.triggerPeddingOrdersAlgoLoading=!1}))},sendOrderSuccessMail(e,t){let s=this.$api.SEND_EMAIL,r={instId:e,content:t,to:O.email,isDemoTrade:this.isDemoTrade?this.$constant.YesOrNo.Yes:this.$constant.YesOrNo.NO_0},o={"Content-Type":"application/json"};rt(s,r,{headers:o}).then((e=>{let t=e.code;1e3==t?(0,w.df)({message:"发送邮件通知成功！",type:"success",position:"top-right",duration:2e3}):(0,w.df)({message:"发送邮件通知失败！",type:"error",position:"top-right",duration:2e3})})).catch((e=>{(0,w.df)({message:"发送邮件通知调用异常！",type:"error",position:"top-right",duration:2e3})}))},doBack(){this.isDemoTrade,this.doDestroy(),this.$router.go(-1)}}};const nt=(0,l.A)(at,[["render",Ve],["__scopeId","data-v-7d697638"]]);var lt=nt;const gt=e=>((0,o.Qi)("data-v-4d8c5ef2"),e=e(),(0,o.jt)(),e),dt={class:"TRADE"},ct=gt((()=>(0,o.Lk)("div",{class:"bg-panel"},[(0,o.Lk)("svg",{class:"canvas",viewBox:"0 0 1920 1080",preserveAspectRatio:"xMaxYMid slice",xmlns:"http://www.w3.org/2000/svg",version:"1.1","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:svgjs":"http://svgjs.dev/svgjs"},[(0,o.Lk)("rect",{width:"1920",height:"1080",fill:"hsl(160, 65%, 15%)"}),(0,o.Lk)("defs",null,[(0,o.Lk)("linearGradient",{x1:"0.5",y1:"0",x2:"0",y2:"1",id:"SvgjsLinearGradient1056"},[(0,o.Lk)("stop",{"stop-color":"#28848a",offset:"0"}),(0,o.Lk)("stop",{"stop-color":"#070614",offset:"0.1"})]),(0,o.Lk)("linearGradient",{x1:"0.5",y1:"0",x2:"0",y2:"1",id:"SvgjsLinearGradient1057"},[(0,o.Lk)("stop",{"stop-color":"#288a7d",offset:"0"}),(0,o.Lk)("stop",{"stop-color":"#060814",offset:"0.22857142857142856"})]),(0,o.Lk)("linearGradient",{x1:"0.5",y1:"0",x2:"0",y2:"1",id:"SvgjsLinearGradient1058"},[(0,o.Lk)("stop",{"stop-color":"#288a7d",offset:"0"}),(0,o.Lk)("stop",{"stop-color":"#060814",offset:"0.3571428571428571"})]),(0,o.Lk)("linearGradient",{x1:"0.5",y1:"0",x2:"0",y2:"1",id:"SvgjsLinearGradient1059"},[(0,o.Lk)("stop",{"stop-color":"#c0f2eb",offset:"0"}),(0,o.Lk)("stop",{"stop-color":"#4256d7",offset:"0.48571428571428565"})]),(0,o.Lk)("linearGradient",{x1:"0.5",y1:"0",x2:"0",y2:"1",id:"SvgjsLinearGradient1060"},[(0,o.Lk)("stop",{"stop-color":"#c0f2e1",offset:"0"}),(0,o.Lk)("stop",{"stop-color":"#4273d7",offset:"0.6142857142857142"})]),(0,o.Lk)("linearGradient",{x1:"0.5",y1:"0",x2:"0",y2:"1",id:"SvgjsLinearGradient1061"},[(0,o.Lk)("stop",{"stop-color":"#c0e4f2",offset:"0"}),(0,o.Lk)("stop",{"stop-color":"#6942d7",offset:"0.7428571428571429"})]),(0,o.Lk)("linearGradient",{x1:"0.5",y1:"0",x2:"0",y2:"1",id:"SvgjsLinearGradient1062"},[(0,o.Lk)("stop",{"stop-color":"#c0f2eb",offset:"0"}),(0,o.Lk)("stop",{"stop-color":"#4256d7",offset:"0.8714285714285713"})])]),(0,o.Lk)("path",{d:"M0,-550.1103893617694C53.15051702178175,-542.9005576707319,212.23503274981857,-543.6870509412055,318.9031021306905,-506.85139921554475C425.57117151156245,-470.015747489884,532.131183661071,-373.7820253624453,640.0084162852315,-329.09647900780504C747.8856489093921,-284.41093265316476,865.8543329053257,-254.5738410077191,966.1664978756536,-238.73812108770292C1066.4786628459815,-222.90240116768675,1130.6043723519513,-260.41871246800406,1241.8814061071987,-234.082159487708C1353.1584398624461,-207.7456065074119,1520.8089347583382,-118.04743156024946,1633.8287004071383,-80.71880320592638C1746.8484660559384,-43.39017485160329,1872.3047834011898,-21.878458335795628,1920,-10.110389361769478L 1920 1080 L 0 1080 Z",fill:'url("#SvgjsLinearGradient1056")'}),(0,o.Lk)("path",{d:"M0,-376.3675552602593C57.55456239365046,-362.4262833533917,222.62386674094887,-333.91484741670854,345.32737436190274,-292.71992381905363C468.0308819828566,-251.52500022139873,596.0499048854844,-173.1873234573175,736.2210457257231,-129.1980136743299C876.3921865659619,-85.20870389134231,1055.691443188624,-67.56761691991186,1186.3542194033355,-28.784065121128094C1317.016995618047,9.999486677655668,1397.9234062478827,69.05292642727548,1520.1977030139933,103.50329711837267C1642.471999780104,137.95366780946986,1853.3662838356656,165.51568204094133,1920,177.91815902545505L 1920 1080 L 0 1080 Z",fill:'url("#SvgjsLinearGradient1057")'}),(0,o.Lk)("path",{d:"M0,-249.22584416347533C38.06286541001003,-229.23895128005958,143.42482244794195,-153.79706108595425,228.3771924600602,-129.3044868629809C313.32956247217845,-104.81191264000752,420.2153569693476,-122.52662201437921,509.7142200727096,-102.27039882563511C599.2130831760716,-82.01417563689101,689.445706216228,-22.736481400607474,765.3703710802321,-7.76714773051625C841.2950359442361,7.2021859395749726,891.6516922994666,-26.950390875704926,965.262209256734,-12.454396805087775C1038.8727262140014,2.0415972655293775,1120.6236628614238,54.30505214473099,1207.0334728238363,79.20881669318666C1293.4432827862488,104.11258124164233,1403.2504430158176,101.15195952787472,1483.7210690312095,136.96819048564623C1564.1916950466014,172.78442144341773,1617.144073754722,263.7099701194312,1689.857228916187,294.1062024398157C1762.570384077652,324.50243476020023,1881.6428714860313,315.13902074659705,1920,319.3455844079533L 1920 1080 L 0 1080 Z",fill:'url("#SvgjsLinearGradient1058")'}),(0,o.Lk)("path",{d:"M0,-114.44944658394024C47.11922347965546,-97.13634947099719,196.63796275461135,-39.56935427902853,282.71534087793276,-10.570863906281886C368.79271900125417,18.427626466464755,430.4016002697071,31.821921332767136,516.4642687399286,59.5414956525396C602.52693721015,87.26106997231207,703.5881752455946,130.2036981883843,799.0913516992614,155.74658201235292C894.5945281529282,181.28946583632154,994.5826888816586,188.36245344948776,1089.483327461929,212.79879859635128C1184.3839660421997,237.2351437432148,1269.2236883535243,277.3615981529843,1368.4951831808849,302.364652893534C1467.7666780082454,327.36770763408373,1593.1948269562401,335.1432864763714,1685.1122964260926,362.81712703964945C1777.029765895945,390.4909676029275,1880.8520494043487,450.80926806761045,1920,468.40769627320265L 1920 1080 L 0 1080 Z",fill:'url("#SvgjsLinearGradient1059")'}),(0,o.Lk)("path",{d:"M0,-2.559641565609539C42.09230156316507,9.031101021417717,167.00680755844485,38.618071329655635,252.55380937899045,66.98481395655399C338.10081119953605,95.35155658345235,423.9751633938783,136.67163186166002,513.2820109232736,167.64081419578065C602.5888584526689,198.60999652990128,691.6113805664884,229.77961929598848,788.3948945553622,252.7999079612777C885.1784085442359,275.82019662656694,995.2083728899813,278.59010851990615,1093.9830948565163,305.762546187516C1192.7578168230514,332.9349838551259,1286.4998795538775,378.5082928147691,1381.0432263545727,415.83453396693693C1475.5865731552678,453.16077511910476,1571.417046719783,499.92854616547106,1661.2431756606875,529.7199931005229C1751.069304601592,559.5114400355747,1876.8738626101147,583.7726784977935,1920,594.5832155772476L 1920 1080 L 0 1080 Z",fill:'url("#SvgjsLinearGradient1060")'}),(0,o.Lk)("path",{d:"M0,126.5972657873171C59.10637716596566,142.52641974886401,248.20802937769753,188.8671311306801,354.638262995794,222.17218955659862C461.06849661389043,255.47724798251716,542.1823866449945,300.5882324246144,638.5814017085788,326.4276163428283C734.9804167721632,352.2670002610422,832.1190661898805,336.36611665782294,933.0323533772997,377.208493065882C1033.945640564719,418.0508694739411,1141.164693201927,521.5475622770368,1244.0611248330943,571.4818747911827C1346.9575564642614,621.4161873053285,1437.7544639698185,649.057041079973,1550.4109431643028,676.8143681507573C1663.067422358787,704.5716952215416,1858.401823860717,727.8239257050333,1920,738.0258372158885L 1920 1080 L 0 1080 Z",fill:'url("#SvgjsLinearGradient1061")'}),(0,o.Lk)("path",{d:"M0,188.95620602856079C48.03716792769223,210.95677163996726,183.67218827118882,283.89707216659303,288.2230075661534,320.9595996969997C392.773826861118,358.0221272274064,510.9468706595705,380.0385355341567,627.3049157697875,411.3313712110007C743.6629608800044,442.6242068878447,880.8087797069696,481.82204630348537,986.3712782274553,508.7166137580637C1091.9337767479408,535.6111812126421,1162.9575008850563,541.1184739424033,1260.6799068927012,572.6987759384709C1358.402312900346,604.2790779345386,1462.8190320887752,657.86980643374,1572.705714273325,698.1984257344693C1682.5923964578747,738.5270450351986,1862.1176190455542,795.2584807414504,1920,814.6704917428466L 1920 1080 L 0 1080 Z",fill:'url("#SvgjsLinearGradient1062")'})])],-1))),pt={class:"align-center"},ht={class:"title-panel"};function ut(e,t,s,r,i,a){const n=lt,l=(0,o.g2)("el-tab-pane"),g=(0,o.g2)("el-tabs");return(0,o.uX)(),(0,o.CE)("div",dt,[ct,(0,o.Lk)("div",pt,[(0,o.Lk)("div",ht,[(0,o.Lk)("span",null,(0,u.v_)(i.userConfig.systemName)+(0,u.v_)("（"+i.userConfig.version+"）"),1)]),(0,o.bF)(g,{type:"border-card",modelValue:i.activeTab,"onUpdate:modelValue":t[0]||(t[0]=e=>i.activeTab=e)},{default:(0,o.k6)((()=>["mock"==i.activeTab?((0,o.uX)(),(0,o.Wv)(l,{key:0,label:"模拟交易",name:"mock"},{default:(0,o.k6)((()=>[(0,o.bF)(n,{ref:"mockTradePanelRef",isDemoTrade:!0,wsPublicUrl:i.paramsConfig.mock.wsPublicUrl,wsPrivacyUrl:i.paramsConfig.mock.wsPrivacyUrl,wsBusinessUrl:i.paramsConfig.mock.wsBusinessUrl,name:i.userConfig.name,updateTime:i.userConfig.updateTime,apiKey:i.userConfig.mock.apiKey,apiSecret:i.userConfig.mock.apiSecret},null,8,["wsPublicUrl","wsPrivacyUrl","wsBusinessUrl","name","updateTime","apiKey","apiSecret"])])),_:1})):(0,o.Q3)("",!0),"real"==i.activeTab?((0,o.uX)(),(0,o.Wv)(l,{key:1,label:"实盘交易",name:"real"},{default:(0,o.k6)((()=>[(0,o.bF)(n,{ref:"realTradePanelRef",isDemoTrade:!1,wsPublicUrl:i.paramsConfig.real.wsPublicUrl,wsPrivacyUrl:i.paramsConfig.real.wsPrivacyUrl,wsBusinessUrl:i.paramsConfig.real.wsBusinessUrl,name:i.userConfig.name,updateTime:i.userConfig.updateTime,apiKey:i.userConfig.real.apiKey,apiSecret:i.userConfig.real.apiSecret},null,8,["wsPublicUrl","wsPrivacyUrl","wsBusinessUrl","name","updateTime","apiKey","apiSecret"])])),_:1})):(0,o.Q3)("",!0)])),_:1},8,["modelValue"])])])}var yt={name:"trade",components:{tradepanel:lt},data(){return{tradeMode:this.$route.params.tradeMode,currentInstId:"BTC-USDT-SWAP",activeTab:"",userConfig:{},paramsConfig:{}}},created(){this.init()},methods:{init(){this.userConfig=O,this.paramsConfig=it,1==this.tradeMode?this.activeTab="real":this.activeTab="mock"}}};const mt=(0,l.A)(yt,[["render",ut],["__scopeId","data-v-4d8c5ef2"]]);var ft=mt;const bt=[{path:"/",name:"home",component:A},{path:"/trade/:tradeMode",name:"trade",component:ft}];var St=bt,Tt={YES:1,NO:2,NO_0:0},Ft={ByTime:0,ByManual:1,ByLimitBreakThrough:2,ByBreakThroughThenRollback:3},kt={BuyAndSell:0,OnlyBuy:1,OnlySell:2},vt={Reverse:0,Homeopathy:1},Ct={ByPercentage:0,ByDistance:1},wt={FromOpenPosition:0,FromForceClosePosition:1},Ot={ByPercentage:0,ByDistance:1},Pt={YesOrNo:Tt,OpenType:Ft,OpenDirection:kt,RollBackDirection:vt,Callback:Ct,TriggerPosition:wt,TriggerType:Ot},xt="/api/v5/account/config",At="/api/v5/account/max-size",Lt="/api/v5/trade/orders-algo-pending",It="/api/v5/trade/order-algo",_t="/api/v5/trade/cancel-algos",Bt="/api/v5/trade/close-position",Dt="/api/v5/account/leverage-info",Mt="/mail/sendEmail",$t={ACCOUNT_CONFIG:xt,MAX_SIZE:At,ORDERS_ALGO_PENDING:Lt,ORDER_ALGO:It,CANCEL_ALGOS:_t,CLOSE_POSITION:Bt,LEVERAGE_INFO:Dt,SEND_EMAIL:Mt},Et=s(8608),Rt=s.n(Et);const Kt=(0,h.aE)({history:(0,h.Bt)(),routes:St}),Wt=(0,r.Ef)(d);Wt.use(Kt),Wt.use(c.A,{size:"normal"}),Wt.use(Rt(),{namespace:"vuejs__",name:"ls",storage:"local"}),Wt.config.globalProperties.$get=et,Wt.config.globalProperties.$post=tt,Wt.config.globalProperties.$constant=Pt,Wt.config.globalProperties.$api=$t,new Ze((e=>e));for(const[Ut,Gt]of Object.entries(p))Wt.component(Ut,Gt);Wt.mount("#app")},9341:function(){}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,r,o,i){if(!r){var a=1/0;for(d=0;d<e.length;d++){r=e[d][0],o=e[d][1],i=e[d][2];for(var n=!0,l=0;l<r.length;l++)(!1&i||a>=i)&&Object.keys(s.O).every((function(e){return s.O[e](r[l])}))?r.splice(l--,1):(n=!1,i<a&&(a=i));if(n){e.splice(d--,1);var g=o();void 0!==g&&(t=g)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[r,o,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,r){var o,i,a=r[0],n=r[1],l=r[2],g=0;if(a.some((function(t){return 0!==e[t]}))){for(o in n)s.o(n,o)&&(s.m[o]=n[o]);if(l)var d=l(s)}for(t&&t(r);g<a.length;g++)i=a[g],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(d)},r=self["webpackChunkokx_web"]=self["webpackChunkokx_web"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=s.O(void 0,[504],(function(){return s(2248)}));r=s.O(r)})();